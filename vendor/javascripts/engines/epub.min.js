(function(p,v){'object'==typeof exports&&'object'==typeof module?module.exports=v(require('xmldom'),function(){try{return require('JSZip')}catch(_){}}()):'function'==typeof define&&define.amd?define(['xmldom','JSZip'],v):'object'==typeof exports?exports.ePub=v(require('xmldom'),function(){try{return require('JSZip')}catch(_){}}()):p.ePub=v(p.xmldom,p.JSZip)})(this,function(s,p){return function(v){function k(C){if(_[C])return _[C].exports;var S=_[C]={i:C,l:!1,exports:{}};return v[C].call(S.exports,S,S.exports,k),S.l=!0,S.exports}var _={};return k.m=v,k.c=_,k.i=function(C){return C},k.d=function(C,S,E){k.o(C,S)||Object.defineProperty(C,S,{configurable:!1,enumerable:!0,get:E})},k.n=function(C){var S=C&&C.__esModule?function(){return C['default']}:function(){return C};return k.d(S,'a',S),S},k.o=function(C,S){return Object.prototype.hasOwnProperty.call(C,S)},k.p='/dist/',k(k.s=28)}([function(v,k,_){'use strict';function C(fe,me){if(!(fe instanceof me))throw new TypeError('Cannot call a class as a function')}function E(){var fe=new Date().getTime(),me='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(ye){var ve=0|(fe+16*Math.random())%16;return fe=Math.floor(fe/16),('x'==ye?ve:8|7&ve).toString(16)});return me}function L(fe){return!isNaN(parseFloat(fe))&&isFinite(fe)}function B(fe,me,ye,ve,be){var ke=ve||0,xe=be||me.length,_e=parseInt(ke+(xe-ke)/2),we;return(ye||(ye=function(Se,Ee){return Se>Ee?1:Se<Ee?-1:Se==Ee?0:void 0}),0>=xe-ke)?_e:(we=ye(me[_e],fe),1==xe-ke?0<=we?_e:_e+1:0===we?_e:-1===we?B(fe,me,ye,_e,xe):B(fe,me,ye,ke,_e))}function O(fe,me,ye,ve,be){var ke=ve||0,xe=be||me.length,_e=parseInt(ke+(xe-ke)/2),we;return(ye||(ye=function(Se,Ee){return Se>Ee?1:Se<Ee?-1:Se==Ee?0:void 0}),0>=xe-ke)?-1:(we=ye(me[_e],fe),1==xe-ke?0===we?_e:-1:0===we?_e:-1===we?O(fe,me,ye,_e,xe):O(fe,me,ye,ke,_e))}function D(fe,me){for(var ye=fe.parentNode,ve=ye.childNodes,ke=-1,xe=0,be;xe<ve.length&&(be=ve[xe],be.nodeType===me&&ke++,be!=fe);xe++);return ke}function X(fe,me){return new Blob([fe],{type:me})}function G(fe,me){return'undefined'==typeof fe.querySelector?fe.getElementsByTagName(me):fe.querySelectorAll(me)}function te(fe,me,ye){for(var ve=document.createTreeWalker(fe,ye,null,!1),be;be=ve.nextNode();)me(be)}function ne(fe,me){if(me(fe))return!0;if(fe=fe.firstChild,fe)do{var ye=ne(fe,me);if(ye)return!0;fe=fe.nextSibling}while(fe)}function le(fe){for(var me=[fe];fe;fe=fe.parentNode)me.unshift(fe);return me}Object.defineProperty(k,'__esModule',{value:!0});var oe=function(){function fe(me,ye){for(var ve=0,be;ve<ye.length;ve++)be=ye[ve],be.enumerable=be.enumerable||!1,be.configurable=!0,'value'in be&&(be.writable=!0),Object.defineProperty(me,be.key,be)}return function(me,ye,ve){return ye&&fe(me.prototype,ye),ve&&fe(me,ve),me}}();k.isElement=function(fe){return!!(fe&&1==fe.nodeType)},k.uuid=E,k.documentHeight=function(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)},k.isNumber=L,k.isFloat=function(fe){return L(fe)&&Math.floor(fe)!==fe},k.prefixed=function(fe){var me=['Webkit','webkit','Moz','O','ms'],ye=['-webkit-','-webkit-','-moz-','-o-','-ms-'],ve=fe[0].toUpperCase()+fe.slice(1),be=me.length;if('undefined'==typeof document||'undefined'!=typeof document.body.style[fe])return fe;for(var ke=0;ke<be;ke++)if('undefined'!=typeof document.body.style[me[ke]+ve])return ye[ke]+fe;return fe},k.defaults=function(fe){for(var me=1,ye=arguments.length,ve;me<ye;me++)for(var be in ve=arguments[me],ve)void 0===fe[be]&&(fe[be]=ve[be]);return fe},k.extend=function(fe){var me=[].slice.call(arguments,1);return me.forEach(function(ye){ye&&Object.getOwnPropertyNames(ye).forEach(function(ve){Object.defineProperty(fe,ve,Object.getOwnPropertyDescriptor(ye,ve))})}),fe},k.insert=function(fe,me,ye){var ve=B(fe,me,ye);return me.splice(ve,0,fe),ve},k.locationOf=B,k.indexOfSorted=O,k.bounds=function(fe){var me=window.getComputedStyle(fe),be=0,ke=0;return['width','paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(xe){be+=parseFloat(me[xe])||0}),['height','paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(xe){ke+=parseFloat(me[xe])||0}),{height:ke,width:be}},k.borders=function(fe){var me=window.getComputedStyle(fe),be=0,ke=0;return['paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(xe){be+=parseFloat(me[xe])||0}),['paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(xe){ke+=parseFloat(me[xe])||0}),{height:ke,width:be}},k.windowBounds=function(){var fe=window.innerWidth,me=window.innerHeight;return{top:0,left:0,right:fe,bottom:me,width:fe,height:me}},k.cleanStringForXpath=function(fe){var me=fe.match(/[^'"]+|['"]/g);return me=me.map(function(ye){return'\''===ye?'"\'"':'"'===ye?'\'"\'':'\''+ye+'\''}),'concat(\'\','+me.join(',')+')'},k.indexOfNode=D,k.indexOfTextNode=function(fe){return D(fe,ce)},k.indexOfElementNode=function(fe){return D(fe,ue)},k.isXml=function(fe){return-1<['xml','opf','ncx'].indexOf(fe)},k.createBlob=X,k.createBlobUrl=function(fe,me){var ye=window.URL||window.webkitURL||window.mozURL,be=X(fe,me),ve;return ve=ye.createObjectURL(be),ve},k.createBase64Url=function(fe,me){var ye,ve;if('string'==typeof fe)return ye=btoa(fe),ve='data:'+me+';base64,'+ye,ve},k.type=function(fe){return Object.prototype.toString.call(fe).slice(8,-1)},k.parse=function(fe,me,ye){var ve,be;return be='undefined'==typeof DOMParser||ye?_(17).DOMParser:DOMParser,65279===fe.charCodeAt(0)&&(fe=fe.slice(1)),ve=new be().parseFromString(fe,me),ve},k.qs=function(fe,me){var ye;if(!fe)throw new Error('No Element Provided');return'undefined'==typeof fe.querySelector?(ye=fe.getElementsByTagName(me),ye.length)?ye[0]:void 0:fe.querySelector(me)},k.qsa=G,k.qsp=function(fe,me,ye){var ve,be;if('undefined'!=typeof fe.querySelector){for(var ke in me+='[',ye)me+=ke+'=\''+ye[ke]+'\'';return me+=']',fe.querySelector(me)}return(ve=fe.getElementsByTagName(me),be=Array.prototype.slice.call(ve,0).filter(function(xe){for(var _e in ye)if(xe.getAttribute(_e)===ye[_e])return!0;return!1}),be)?be[0]:void 0},k.sprint=function(fe,me){var ye=fe.ownerDocument||fe;'undefined'==typeof ye.createTreeWalker?ne(fe,function(ve){ve&&3===ve.nodeType&&me(ve)},!0):te(fe,me,NodeFilter.SHOW_TEXT)},k.treeWalker=te,k.walk=ne,k.blob2base64=function(fe){return new Promise(function(me){var ve=new FileReader;ve.readAsDataURL(fe),ve.onloadend=function(){me(ve.result)}})},k.defer=function(){var fe=this;this.resolve=null,this.reject=null,this.id=E(),this.promise=new Promise(function(me,ye){fe.resolve=me,fe.reject=ye}),Object.freeze(this)},k.querySelectorByType=function(fe,me,ye){var ve;if('undefined'!=typeof fe.querySelector&&(ve=fe.querySelector(me+'[*|type="'+ye+'"]')),!ve||0===ve.length){ve=G(fe,me);for(var be=0;be<ve.length;be++)if(ve[be].getAttributeNS('http://www.idpf.org/2007/ops','type')===ye||ve[be].getAttribute('epub:type')===ye)return ve[be]}else return ve},k.findChildren=function(fe){for(var me=[],ye=fe.childNodes,ve=0,be;ve<ye.length;ve++)be=ye[ve],1===be.nodeType&&me.push(be);return me},k.parents=le;var de=k.requestAnimationFrame='undefined'!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),ue=1,ce=3,ge=k.RangeObject=function(){function fe(){C(this,fe),this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}return oe(fe,[{key:'setStart',value:function(ye,ve){this.startContainer=ye,this.startOffset=ve,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}},{key:'setEnd',value:function(ye,ve){this.endContainer=ye,this.endOffset=ve,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}},{key:'collapse',value:function(ye){this.collapsed=!0,ye?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}},{key:'selectNode',value:function(ye){var ve=ye.parentNode,be=Array.prototype.indexOf.call(ve.childNodes,ye);this.setStart(ve,be),this.setEnd(ve,be+1)}},{key:'selectNodeContents',value:function(ye){var ve=ye.childNodes[ye.childNodes-1],be=3===ye.nodeType?ye.textContent.length:parent.childNodes.length;this.setStart(ye,0),this.setEnd(ye,be)}},{key:'_commonAncestorContainer',value:function(ye,ve){var be=le(ye||this.startContainer),ke=le(ve||this.endContainer);if(be[0]==ke[0])for(var xe=0;xe<be.length;xe++)if(be[xe]!=ke[xe])return be[xe-1]}},{key:'_checkCollapsed',value:function(){this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset}},{key:'toString',value:function(){}}]),fe}()},function(v,k,_){'use strict';function C(N,A){if(!(N instanceof A))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(N){return typeof N}:function(N){return N&&'function'==typeof Symbol&&N.constructor===Symbol&&N!==Symbol.prototype?'symbol':typeof N},E=function(){function N(A,B){for(var O=0,I;O<B.length;O++)I=B[O],I.enumerable=I.enumerable||!1,I.configurable=!0,'value'in I&&(I.writable=!0),Object.defineProperty(A,I.key,I)}return function(A,B,O){return B&&N(A.prototype,B),O&&N(A,O),A}}(),P=_(0),L=1,R=3,z=function(){function N(A,B,O){C(this,N);var I;if(this.str='',this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof N))return new N(A,B,O);if('string'==typeof B?this.base=this.parseComponent(B):'object'===('undefined'==typeof B?'undefined':S(B))&&B.steps&&(this.base=B),I=this.checkType(A),'string'===I)return this.str=A,(0,P.extend)(this,this.parse(A));if('range'===I)return(0,P.extend)(this,this.fromRange(A,this.base,O));if('node'===I)return(0,P.extend)(this,this.fromNode(A,this.base,O));if('EpubCFI'===I&&A.path)return A;if(!A)return this;throw new TypeError('not a valid argument for EpubCFI')}return E(N,[{key:'checkType',value:function(B){return this.isCfiString(B)?'string':'object'===('undefined'==typeof B?'undefined':S(B))&&('Range'===(0,P.type)(B)||'undefined'!=typeof B.startContainer)?'range':'object'===('undefined'==typeof B?'undefined':S(B))&&'undefined'!=typeof B.nodeType?'node':'object'===('undefined'==typeof B?'undefined':S(B))&&B instanceof N&&'EpubCFI'}},{key:'parse',value:function(B){var O={spinePos:-1,range:!1,base:{},path:{},start:null,end:null},I,M,U;return'string'==typeof B?(0===B.indexOf('epubcfi(')&&')'===B[B.length-1]&&(B=B.slice(8,B.length-1)),I=this.getChapterComponent(B),!I)?{spinePos:-1}:(O.base=this.parseComponent(I),M=this.getPathComponent(B),O.path=this.parseComponent(M),U=this.getRange(B),U&&(O.range=!0,O.start=this.parseComponent(U[0]),O.end=this.parseComponent(U[1])),O.spinePos=O.base.steps[1].index,O):{spinePos:-1}}},{key:'parseComponent',value:function(B){var O={steps:[],terminal:{offset:null,assertion:null}},I=B.split(':'),M=I[0].split('/'),U;return 1<I.length&&(U=I[1],O.terminal=this.parseTerminal(U)),''===M[0]&&M.shift(),O.steps=M.map(function(W){return this.parseStep(W)}.bind(this)),O}},{key:'parseStep',value:function(B){var O,I,M,U,W;if(U=B.match(/\[(.*)\]/),U&&U[1]&&(W=U[1]),I=parseInt(B),!isNaN(I))return 0==I%2?(O='element',M=I/2-1):(O='text',M=(I-1)/2),{type:O,index:M,id:W||null}}},{key:'parseTerminal',value:function(B){var M=B.match(/\[(.*)\]/),O,I;return M&&M[1]?(O=parseInt(B.split('[')[0]),I=M[1]):O=parseInt(B),(0,P.isNumber)(O)||(O=null),{offset:O,assertion:I}}},{key:'getChapterComponent',value:function(B){var O=B.split('!');return O[0]}},{key:'getPathComponent',value:function(B){var O=B.split('!');if(O[1]){var I=O[1].split(',');return I[0]}}},{key:'getRange',value:function(B){var O=B.split(',');return 3===O.length&&[O[1],O[2]]}},{key:'getCharecterOffsetComponent',value:function(B){var O=B.split(':');return O[1]||''}},{key:'joinSteps',value:function(B){return B?B.map(function(O){var I='';return'element'===O.type&&(I+=2*(O.index+1)),'text'===O.type&&(I+=1+2*O.index),O.id&&(I+='['+O.id+']'),I}).join('/'):''}},{key:'segmentString',value:function(B){var A='/';return A+=this.joinSteps(B.steps),B.terminal&&null!=B.terminal.offset&&(A+=':'+B.terminal.offset),B.terminal&&null!=B.terminal.assertion&&(A+='['+B.terminal.assertion+']'),A}},{key:'toString',value:function(){var B='epubcfi(';return B+=this.segmentString(this.base),B+='!',B+=this.segmentString(this.path),this.range&&this.start&&(B+=',',B+=this.segmentString(this.start)),this.range&&this.end&&(B+=',',B+=this.segmentString(this.end)),B+=')',B}},{key:'compare',value:function(B,O){var I,M,U,W,H,H;if('string'==typeof B&&(B=new N(B)),'string'==typeof O&&(O=new N(O)),B.spinePos>O.spinePos)return 1;if(B.spinePos<O.spinePos)return-1;B.range?(I=B.path.steps.concat(B.start.steps),U=B.start.terminal):(I=B.path.steps,U=B.path.terminal),O.range?(M=O.path.steps.concat(O.start.steps),W=O.start.terminal):(M=O.path.steps,W=O.path.terminal);for(var Z=0;Z<I.length;Z++){if(!I[Z])return-1;if(!M[Z])return 1;if(I[Z].index>M[Z].index)return 1;if(I[Z].index<M[Z].index)return-1}return I.length<M.length?1:U.offset>W.offset?1:U.offset<W.offset?-1:0}},{key:'step',value:function(B){var O=B.nodeType===R?'text':'element';return{id:B.id,tagName:B.tagName,type:O,index:this.position(B)}}},{key:'filteredStep',value:function(B,O){var I=this.filter(B,O),M;if(I)return M=I.nodeType===R?'text':'element',{id:I.id,tagName:I.tagName,type:M,index:this.filteredPosition(I,O)}}},{key:'pathTo',value:function(B,O,I){for(var M={steps:[],terminal:{offset:null,assertion:null}},U=B,W;U&&U.parentNode&&U.parentNode.nodeType!=9;)W=I?this.filteredStep(U,I):this.step(U),W&&M.steps.unshift(W),U=U.parentNode;return null!=O&&0<=O&&(M.terminal.offset=O,'text'!=M.steps[M.steps.length-1].type&&M.steps.push({type:'text',index:0})),M}},{key:'equalStep',value:function(B,O){return B&&O&&B.index===O.index&&B.id===O.id&&B.type===O.type}},{key:'fromRange',value:function(B,O,I){var M={range:!1,base:{},path:{},start:null,end:null},U=B.startContainer,W=B.endContainer,D=B.startOffset,F=B.endOffset,H=!1;if(I&&(H=null!=U.ownerDocument.querySelector('.'+I)),'string'==typeof O?(M.base=this.parseComponent(O),M.spinePos=M.base.steps[1].index):'object'===('undefined'==typeof O?'undefined':S(O))&&(M.base=O),B.collapsed)H&&(D=this.patchOffset(U,D,I)),M.path=this.pathTo(U,D,I);else{M.range=!0,H&&(D=this.patchOffset(U,D,I)),M.start=this.pathTo(U,D,I),H&&(F=this.patchOffset(W,F,I)),M.end=this.pathTo(W,F,I),M.path={steps:[],terminal:null};var V=M.start.steps.length,X;for(X=0;X<V&&this.equalStep(M.start.steps[X],M.end.steps[X]);X++)X===V-1?M.start.terminal===M.end.terminal&&(M.path.steps.push(M.start.steps[X]),M.range=!1):M.path.steps.push(M.start.steps[X]);M.start.steps=M.start.steps.slice(M.path.steps.length),M.end.steps=M.end.steps.slice(M.path.steps.length)}return M}},{key:'fromNode',value:function(B,O,I){var M={range:!1,base:{},path:{},start:null,end:null};return'string'==typeof O?(M.base=this.parseComponent(O),M.spinePos=M.base.steps[1].index):'object'===('undefined'==typeof O?'undefined':S(O))&&(M.base=O),M.path=this.pathTo(B,null,I),M}},{key:'filter',value:function(B,O){var F=!1,I,M,U,W,D;return B.nodeType===R?(F=!0,U=B.parentNode,I=B.parentNode.classList.contains(O)):(F=!1,I=B.classList.contains(O)),I&&F?(W=U.previousSibling,D=U.nextSibling,W&&W.nodeType===R?M=W:D&&D.nodeType===R&&(M=D),M?M:B):I&&!F?!1:B}},{key:'patchOffset',value:function(B,O,I){if(B.nodeType!=R)throw new Error('Anchor must be a text node');var M=B,U=O;for(B.parentNode.classList.contains(I)&&(M=B.parentNode);M.previousSibling;){if(M.previousSibling.nodeType!==L)U+=M.previousSibling.textContent.length;else if(M.previousSibling.classList.contains(I))U+=M.previousSibling.textContent.length;else break;M=M.previousSibling}return U}},{key:'normalizedMap',value:function(B,O,I){var M={},U=-1,D=B.length,W,F,H;for(W=0;W<D;W++)F=B[W].nodeType,F===L&&B[W].classList.contains(I)&&(F=R),0<W&&F===R&&H===R?M[W]=U:O===F&&(++U,M[W]=U),H=F;return M}},{key:'position',value:function(B){var O,I;return B.nodeType===L?(O=B.parentNode.children,!O&&(O=(0,P.findChildren)(B.parentNode)),I=Array.prototype.indexOf.call(O,B)):(O=this.textNodes(B.parentNode),I=O.indexOf(B)),I}},{key:'filteredPosition',value:function(B,O){var I,M,U;return B.nodeType===L?(I=B.parentNode.children,U=this.normalizedMap(I,L,O)):(I=B.parentNode.childNodes,B.parentNode.classList.contains(O)&&(B=B.parentNode,I=B.parentNode.childNodes),U=this.normalizedMap(I,R,O)),M=Array.prototype.indexOf.call(I,B),U[M]}},{key:'stepsToXpath',value:function(B){var O=['.','*'];return B.forEach(function(I){var M=I.index+1;I.id?O.push('*[position()='+M+' and @id=\''+I.id+'\']'):'text'===I.type?O.push('text()['+M+']'):O.push('*['+M+']')}),O.join('/')}},{key:'stepsToQuerySelector',value:function(B){var O=['html'];return B.forEach(function(I){var M=I.index+1;I.id?O.push('#'+I.id):'text'===I.type||O.push('*:nth-child('+M+')')}),O.join('>')}},{key:'textNodes',value:function(B,O){return Array.prototype.slice.call(B.childNodes).filter(function(I){return I.nodeType===R||O&&I.classList.contains(O)})}},{key:'walkToNode',value:function(B,O,I){var M=O||document,U=M.documentElement,F=B.length,W,D,H;for(H=0;H<F&&(D=B[H],'element'===D.type?D.id?U=M.getElementById(D.id):(W=U.children||(0,P.findChildren)(U),U=W[D.index]):'text'===D.type&&(U=this.textNodes(U,I)[D.index]),!!U);H++);return U}},{key:'findNode',value:function(B,O,I){var M=O||document,U,W;return I||'undefined'==typeof M.evaluate?I?U=this.walkToNode(B,M,I):U=this.walkToNode(B,M):(W=this.stepsToXpath(B),U=M.evaluate(W,M,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),U}},{key:'fixMiss',value:function(B,O,I,M){var U=this.findNode(B.slice(0,-1),I,M),W=U.childNodes,D=this.normalizedMap(W,R,M),V=B[B.length-1].index,F,H;for(var X in D){if(!D.hasOwnProperty(X))return;if(D[X]===V)if(F=W[X],H=F.textContent.length,O>H)O-=H;else{U=F.nodeType===L?F.childNodes[0]:F;break}}return{container:U,offset:O}}},{key:'toRange',value:function(B,O){var I=B||document,H=this,Y=!!O&&null!=I.querySelector('.'+O),M,U,W,D,F,V,X,J;if(M='undefined'==typeof I.createRange?new P.RangeObject:I.createRange(),H.range?(U=H.start,V=H.path.steps.concat(U.steps),D=this.findNode(V,I,Y?O:null),W=H.end,X=H.path.steps.concat(W.steps),F=this.findNode(X,I,Y?O:null)):(U=H.path,V=H.path.steps,D=this.findNode(H.path.steps,I,Y?O:null)),D)try{null==U.terminal.offset?M.setStart(D,0):M.setStart(D,U.terminal.offset)}catch(Z){J=this.fixMiss(V,U.terminal.offset,I,Y?O:null),M.setStart(J.container,J.offset)}else return console.log('NO START'),null;if(F)try{null==W.terminal.offset?M.setEnd(F,0):M.setEnd(F,W.terminal.offset)}catch(Z){J=this.fixMiss(X,H.end.terminal.offset,I,Y?O:null),M.setEnd(J.container,J.offset)}return M}},{key:'isCfiString',value:function(B){return'string'==typeof B&&0===B.indexOf('epubcfi(')&&')'===B[B.length-1]}},{key:'generateChapterComponent',value:function(B,O,I){var M=parseInt(O),W='/'+2*(B+1)+'/';return W+=2*(M+1),I&&(W+='['+I+']'),W}},{key:'collapse',value:function(B){this.range&&(this.range=!1,B?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}]),N}();k.default=z,v.exports=k['default']},function(v,k,_){'use strict';var C=_(40),S=_(50),E=Function.prototype.apply,P=Function.prototype.call,L=Object.create,R=Object.defineProperty,T=Object.defineProperties,z=Object.prototype.hasOwnProperty,N={configurable:!0,enumerable:!1,writable:!0},A,B,O,I,M,U,W;A=function(D,F){var H;return S(F),z.call(this,'__ee__')?H=this.__ee__:(H=N.value=L(null),R(this,'__ee__',N),N.value=null),H[D]?'object'==typeof H[D]?H[D].push(F):H[D]=[H[D],F]:H[D]=F,this},B=function(D,F){var H,V;return S(F),V=this,A.call(this,D,H=function(){O.call(V,D,H),E.call(F,this,arguments)}),H.__eeOnceListener__=F,this},O=function(D,F){var H,V,X,Y;if(S(F),!z.call(this,'__ee__'))return this;if(H=this.__ee__,!H[D])return this;if(V=H[D],'object'==typeof V)for(Y=0;X=V[Y];++Y)(X===F||X.__eeOnceListener__===F)&&(2===V.length?H[D]=V[Y?0:1]:V.splice(Y,1));else(V===F||V.__eeOnceListener__===F)&&delete H[D];return this},I=function(D){var F,H,V,X,Y;if(z.call(this,'__ee__')&&(X=this.__ee__[D],!!X))if('object'==typeof X){for(H=arguments.length,Y=Array(H-1),F=1;F<H;++F)Y[F-1]=arguments[F];for(X=X.slice(),F=0;V=X[F];++F)E.call(V,this,Y)}else switch(arguments.length){case 1:P.call(X,this);break;case 2:P.call(X,this,arguments[1]);break;case 3:P.call(X,this,arguments[1],arguments[2]);break;default:for(H=arguments.length,Y=Array(H-1),F=1;F<H;++F)Y[F-1]=arguments[F];E.call(X,this,Y);}},M={on:A,once:B,off:O,emit:I},U={on:C(A),once:C(B),off:C(O),emit:C(I)},W=T({},U),v.exports=k=function(D){return null==D?L(W):T(Object(D),U)},k.methods=M},function(v,k,_){'use strict';function S(T,z){if(!(T instanceof z))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function T(z,N){for(var A=0,B;A<N.length;A++)B=N[A],B.enumerable=B.enumerable||!1,B.configurable=!0,'value'in B&&(B.writable=!0),Object.defineProperty(z,B.key,B)}return function(z,N,A){return N&&T(z.prototype,N),A&&T(z,A),z}}(),P=_(6),L=function(T){return T&&T.__esModule?T:{default:T}}(P),R=function(){function T(z){S(this,T);var N,A;N=z.indexOf('://'),-1<N&&(z=new URL(z).pathname),A=this.parse(z),this.path=z,this.directory=this.isDirectory(z)?z:A.dir+'/',this.filename=A.base,this.extension=A.ext.slice(1)}return E(T,[{key:'parse',value:function(N){return L.default.parse(N)}},{key:'isAbsolute',value:function(N){return L.default.isAbsolute(N||this.path)}},{key:'isDirectory',value:function(N){return'/'===N.charAt(N.length-1)}},{key:'resolve',value:function(N){return L.default.resolve(this.directory,N)}},{key:'relative',value:function(N){return L.default.relative(this.directory,N)}},{key:'splitPath',value:function(N){return this.splitPathRe.exec(N).slice(1)}},{key:'toString',value:function(){return this.path}}]),T}();k.default=R,v.exports=k['default']},function(v,k,_){'use strict';function C(O){return O&&O.__esModule?O:{default:O}}Object.defineProperty(k,'__esModule',{value:!0}),k.replaceBase=function(O,I){var M,U;O&&(U=(0,T.qs)(O,'head'),M=(0,T.qs)(U,'base'),!M&&(M=O.createElement('base'),U.insertBefore(M,U.firstChild)),M.setAttribute('href',I.url))},k.replaceCanonical=function(O,I){var M,U,W=I.url;O&&(M=(0,T.qs)(O,'head'),U=(0,T.qs)(M,'link[rel=\'canonical\']'),U?U.setAttribute('href',W):(U=O.createElement('link'),U.setAttribute('rel','canonical'),U.setAttribute('href',W),M.appendChild(U)))},k.replaceMeta=function(O,I){var M,U,W=I.idref;O&&(M=(0,T.qs)(O,'head'),U=(0,T.qs)(M,'link[property=\'dc:identifier\']'),U?U.setAttribute('content',W):(U=O.createElement('meta'),U.setAttribute('property','dc:identifier'),U.setAttribute('content',W),M.appendChild(U)))},k.replaceLinks=function(O,I){var M=O.querySelectorAll('a[href]');if(M.length)for(var U=(0,T.qs)(O.ownerDocument,'base'),W=U?U.getAttribute('href'):void 0,D=function(H){var V=H.getAttribute('href');if(0!==V.indexOf('mailto:')){var X=-1<V.indexOf('://'),Y=new N.default(V,W);X?H.setAttribute('target','_blank'):H.onclick=function(){return Y&&Y.hash?I(Y.Path.path+Y.hash):Y?I(Y.Path.path):I(V),!1}}}.bind(this),F=0;F<M.length;F++)D(M[F])},k.substitute=function(O,I,M){return I.forEach(function(U,W){U&&M[W]&&(O=O.replace(new RegExp(U,'g'),M[W]))}),O};var T=_(0),z=_(5),N=C(z),A=_(3),B=C(A)},function(v,k,_){'use strict';function C(N){return N&&N.__esModule?N:{default:N}}function S(N,A){if(!(N instanceof A))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function N(A,B){for(var O=0,I;O<B.length;O++)I=B[O],I.enumerable=I.enumerable||!1,I.configurable=!0,'value'in I&&(I.writable=!0),Object.defineProperty(A,I.key,I)}return function(A,B,O){return B&&N(A.prototype,B),O&&N(A,O),A}}(),P=_(3),L=C(P),R=_(6),T=C(R),z=function(){function N(A,B){S(this,N);var O=-1<A.indexOf('://'),I=A,M;if(this.Url=void 0,this.href=A,this.protocol='',this.origin='',this.hash='',this.hash='',this.search='',this.base=B,!O&&!1!==B&&'string'!=typeof B&&window&&window.location&&(this.base=window.location.href),O||this.base)try{this.Url=this.base?new URL(A,this.base):new URL(A),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,I=this.Url.pathname}catch(U){this.Url=void 0,this.base&&(M=new L.default(this.base),I=M.resolve(I))}this.Path=new L.default(I),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}return E(N,[{key:'path',value:function(){return this.Path}},{key:'resolve',value:function(B){var O=-1<B.indexOf('://'),I;return O?B:(I=T.default.resolve(this.directory,B),this.origin+I)}},{key:'relative',value:function(B){return T.default.relative(B,this.directory)}},{key:'toString',value:function(){return this.href}}]),N}();k.default=z,v.exports=k['default']},function(v){'use strict';function C(R){if('string'!=typeof R)throw new TypeError('Path must be a string. Received '+R)}function S(R,T){for(var z='',N=-1,A=0,O=0,B;O<=R.length;++O){if(O<R.length)B=R.charCodeAt(O);else if(47===B)break;else B=47;if(47===B){if(N==O-1||1==A);else if(N!=O-1&&2==A){if(2>z.length||46!==z.charCodeAt(z.length-1)||46!==z.charCodeAt(z.length-2))if(2<z.length){for(var I=z.length-1,M=I;0<=M&&47!==z.charCodeAt(M);--M);if(M!=I){z=-1==M?'':z.slice(0,M),N=O,A=0;continue}}else if(2===z.length||1===z.length){z='',N=O,A=0;continue}T&&(0<z.length?z+='/..':z='..')}else 0<z.length?z+='/'+R.slice(N+1,O):z=R.slice(N+1,O);N=O,A=0}else 46===B&&-1!=A?++A:A=-1}return z}function E(R,T){var z=T.dir||T.root,N=T.base||(T.name||'')+(T.ext||'');return z?z===T.root?z+N:z+R+N:N}if(!P)var P={cwd:function(){return'/'}};var L={resolve:function(){for(var T='',z=!1,A=arguments.length-1,N;-1<=A&&!z;A--){var B;(0<=A?B=arguments[A]:(void 0==N&&(N=P.cwd()),B=N),C(B),0!==B.length)&&(T=B+'/'+T,z=47===B.charCodeAt(0))}return T=S(T,!z),z?0<T.length?'/'+T:'/':0<T.length?T:'.'},normalize:function(T){if(C(T),0===T.length)return'.';var z=47===T.charCodeAt(0),N=47===T.charCodeAt(T.length-1);return T=S(T,!z),0!==T.length||z||(T='.'),0<T.length&&N&&(T+='/'),z?'/'+T:T},isAbsolute:function(T){return C(T),0<T.length&&47===T.charCodeAt(0)},join:function(){if(0===arguments.length)return'.';for(var z=0,T,N;z<arguments.length;++z)N=arguments[z],C(N),0<N.length&&(void 0==T?T=N:T+='/'+N);return void 0===T?'.':L.normalize(T)},relative:function(T,z){if(C(T),C(z),T===z)return'';if(T=L.resolve(T),z=L.resolve(z),T===z)return'';for(var N=1;N<T.length&&47===T.charCodeAt(N);++N);for(var A=T.length,B=A-N,O=1;O<z.length&&47===z.charCodeAt(O);++O);for(var I=z.length,M=I-O,U=B<M?B:M,W=-1,D=0;D<=U;++D){if(D==U){if(M>U){if(47===z.charCodeAt(O+D))return z.slice(O+D+1);if(0==D)return z.slice(O+D)}else B>U&&(47===T.charCodeAt(N+D)?W=D:0==D&&(W=0));break}var F=T.charCodeAt(N+D),H=z.charCodeAt(O+D);if(F!==H)break;else 47===F&&(W=D)}var V='';for(D=N+W+1;D<=A;++D)(D===A||47===T.charCodeAt(D))&&(V+=0===V.length?'..':'/..');return 0<V.length?V+z.slice(O+W):(O+=W,47===z.charCodeAt(O)&&++O,z.slice(O))},_makeLong:function(T){return T},dirname:function(T){if(C(T),0===T.length)return'.';for(var z=T.charCodeAt(0),N=47===z,A=-1,B=!0,O=T.length-1;1<=O;--O)if(z=T.charCodeAt(O),47!==z)B=!1;else if(!B){A=O;break}return-1===A?N?'/':'.':N&&1===A?'//':T.slice(0,A)},basename:function(T,z){if(z!==void 0&&'string'!=typeof z)throw new TypeError('"ext" argument must be a string');C(T);var N=0,A=-1,B=!0,O;if(void 0!==z&&0<z.length&&z.length<=T.length){if(z.length===T.length&&z===T)return'';var I=z.length-1,M=-1;for(O=T.length-1;0<=O;--O){var U=T.charCodeAt(O);if(47!==U)-1==M&&(B=!1,M=O+1),0<=I&&(U===z.charCodeAt(I)?-1==--I&&(A=O):(I=-1,A=M));else if(!B){N=O+1;break}}return N===A?A=M:-1===A&&(A=T.length),T.slice(N,A)}for(O=T.length-1;0<=O;--O)if(47!==T.charCodeAt(O))-1==A&&(B=!1,A=O+1);else if(!B){N=O+1;break}return-1===A?'':T.slice(N,A)},extname:function(T){C(T);for(var z=-1,N=0,A=-1,B=!0,O=0,I=T.length-1,M;0<=I;--I){if(M=T.charCodeAt(I),47===M){if(!B){N=I+1;break}continue}-1==A&&(B=!1,A=I+1),46===M?-1==z?z=I:1!=O&&(O=1):-1!==z&&(O=-1)}return-1===z||-1===A||0==O||1==O&&z===A-1&&z===N+1?'':T.slice(z,A)},format:function(T){if(null===T||'object'!=typeof T)throw new TypeError('Parameter "pathObject" must be an object, not '+typeof T);return E('/',T)},parse:function(T){C(T);var z={root:'',dir:'',base:'',ext:'',name:''};if(0===T.length)return z;var N=T.charCodeAt(0),A=47===N,B;A?(z.root='/',B=1):B=0;for(var O=-1,I=0,M=-1,U=!0,W=T.length-1,D=0;W>=B;--W){if(N=T.charCodeAt(W),47===N){if(!U){I=W+1;break}continue}-1==M&&(U=!1,M=W+1),46===N?-1==O?O=W:1!=D&&(D=1):-1!=O&&(D=-1)}return-1==O||-1==M||0==D||1==D&&O==M-1&&O==I+1?-1!=M&&(0==I&&A?z.base=z.name=T.slice(1,M):z.base=z.name=T.slice(I,M)):(0==I&&A?(z.name=T.slice(1,O),z.base=T.slice(1,M)):(z.name=T.slice(I,O),z.base=T.slice(I,M)),z.ext=T.slice(O,M)),0<I?z.dir=T.slice(0,I-1):A&&(z.dir='/'),z},sep:'/',delimiter:':',posix:null};v.exports=L},function(v,k,_){'use strict';function C(U){return U&&U.__esModule?U:{default:U}}function S(U,W){if(!(U instanceof W))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function U(W,D){for(var F=0,H;F<D.length;F++)H=D[F],H.enumerable=H.enumerable||!1,H.configurable=!0,'value'in H&&(H.writable=!0),Object.defineProperty(W,H.key,H)}return function(W,D,F){return D&&U(W.prototype,D),F&&U(W,F),W}}(),P=_(2),L=C(P),R=_(0),T=_(1),z=C(T),N=_(8),A=C(N),B=_(4),O=_(23),I=['keydown','keyup','keypressed','mouseup','mousedown','click','touchend','touchstart'],M=function(){function U(W,D,F,H){S(this,U),this.epubcfi=new z.default,this.document=W,this.documentElement=this.document.documentElement,this.content=D||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=H||0,this.cfiBase=F||'',this.pane=void 0,this.highlights={},this.underlines={},this.marks={},this.listeners()}return E(U,[{key:'width',value:function(D){var F=this.content;return D&&(0,R.isNumber)(D)&&(D+='px'),D&&(F.style.width=D),this.window.getComputedStyle(F).width}},{key:'height',value:function(D){var F=this.content;return D&&(0,R.isNumber)(D)&&(D+='px'),D&&(F.style.height=D),this.window.getComputedStyle(F).height}},{key:'contentWidth',value:function(D){var F=this.content||this.document.body;return D&&(0,R.isNumber)(D)&&(D+='px'),D&&(F.style.width=D),this.window.getComputedStyle(F).width}},{key:'contentHeight',value:function(D){var F=this.content||this.document.body;return D&&(0,R.isNumber)(D)&&(D+='px'),D&&(F.style.height=D),this.window.getComputedStyle(F).height}},{key:'textWidth',value:function(){var F=this.document.createRange(),H=this.content||this.document.body,D;return F.selectNodeContents(H),D=F.getBoundingClientRect().width,D}},{key:'textHeight',value:function(){var F=this.document.createRange(),H=this.content||this.document.body,D;return F.selectNodeContents(H),D=F.getBoundingClientRect().height,D}},{key:'scrollWidth',value:function(){var D=this.documentElement.scrollWidth;return D}},{key:'scrollHeight',value:function(){var D=this.documentElement.scrollHeight;return D}},{key:'overflow',value:function(D){return D&&(this.documentElement.style.overflow=D),this.window.getComputedStyle(this.documentElement).overflow}},{key:'overflowX',value:function(D){return D&&(this.documentElement.style.overflowX=D),this.window.getComputedStyle(this.documentElement).overflowX}},{key:'overflowY',value:function(D){return D&&(this.documentElement.style.overflowY=D),this.window.getComputedStyle(this.documentElement).overflowY}},{key:'css',value:function(D,F,H){var V=this.content||this.document.body;return F&&V.style.setProperty(D,F,H?'important':''),this.window.getComputedStyle(V)[D]}},{key:'viewport',value:function(D){var te=this.document.querySelector('meta[name=\'viewport\']'),ne={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},ae=[],Z,Q;if(te&&te.hasAttribute('content')){var ie=te.getAttribute('content'),se=ie.match(/width\s*=\s*([^,]*)/g),re=ie.match(/height\s*=\s*([^,]*)/g),le=ie.match(/initial-scale\s*=\s*([^,]*)/g),oe=ie.match(/minimum-scale\s*=\s*([^,]*)/g),de=ie.match(/maximum-scale\s*=\s*([^,]*)/g),ue=ie.match(/user-scalable\s*=\s*([^,]*)/g);se&&se.length&&'undefined'!=typeof se[1]&&(ne.width=se[1]),re&&re.length&&'undefined'!=typeof re[1]&&(ne.height=re[1]),le&&le.length&&'undefined'!=typeof le[1]&&(ne.scale=le[1]),oe&&oe.length&&'undefined'!=typeof oe[1]&&(ne.minimum=oe[1]),de&&de.length&&'undefined'!=typeof de[1]&&(ne.maximum=de[1]),ue&&ue.length&&'undefined'!=typeof ue[1]&&(ne.scalable=ue[1])}return D&&((D.width||ne.width)&&ae.push('width='+(D.width||ne.width)),(D.height||ne.height)&&ae.push('height='+(D.height||ne.height)),(D.scale||ne.scale)&&ae.push('initial-scale='+(D.scale||ne.scale)),(D.scalable||ne.scalable)&&(ae.push('minimum-scale='+(D.scale||ne.minimum)),ae.push('maximum-scale='+(D.scale||ne.maximum)),ae.push('user-scalable='+(D.scalable||ne.scalable))),!te&&(te=this.document.createElement('meta'),te.setAttribute('name','viewport'),this.document.querySelector('head').appendChild(te)),te.setAttribute('content',ae.join(', ')),this.window.scrollTo(0,0)),{width:parseInt(Z),height:parseInt(Q)}}},{key:'expand',value:function(){this.emit('expand')}},{key:'listeners',value:function(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),this.transitionListeners(),this.resizeListeners(),this.resizeObservers(),this.linksHandler()}},{key:'removeListeners',value:function(){this.removeEventListeners(),this.removeSelectionListeners(),clearTimeout(this.expanding)}},{key:'resizeCheck',value:function(){var D=this.textWidth(),F=this.textHeight();(D!=this._size.width||F!=this._size.height)&&(this._size={width:D,height:F},this.pane&&this.pane.render(),this.onResize&&this.onResize(this._size),this.emit('resize',this._size))}},{key:'resizeListeners',value:function(){var D,F;clearTimeout(this.expanding),D=this.textWidth(),F=this.textHeight(),this.resizeCheck(),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}},{key:'transitionListeners',value:function(){var D=this.content;D.style.transitionProperty='font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height',D.style.transitionDuration='0.001ms',D.style.transitionTimingFunction='linear',D.style.transitionDelay='0',this.document.addEventListener('transitionend',this.resizeCheck.bind(this))}},{key:'mediaQueryListeners',value:function(){for(var D=this.document.styleSheets,F=function(J){J.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),H=0;H<D.length;H+=1){var V;try{V=D[H].cssRules}catch(J){return}if(!V)return;for(var X=0;X<V.length;X+=1)if(V[X].media){var Y=this.window.matchMedia(V[X].media.mediaText);Y.addListener(F)}}}},{key:'resizeObservers',value:function(){var D=this;this.observer=new MutationObserver(function(){D.resizeCheck()});this.observer.observe(this.document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}},{key:'imageLoadListeners',value:function(){for(var F=this.document.querySelectorAll('img'),V=0,H;V<F.length;V++)H=F[V],'undefined'!=typeof H.naturalWidth&&0===H.naturalWidth&&(H.onload=this.expand.bind(this))}},{key:'fontLoadListeners',value:function(){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.expand()}.bind(this))}},{key:'root',value:function(){return this.document?this.document.documentElement:null}},{key:'locationOf',value:function(D,F){var V={left:0,top:0},H;if(this.document){if(this.epubcfi.isCfiString(D)){var X=new z.default(D).toRange(this.document,F);X&&(X.startContainer.nodeType===Node.ELEMENT_NODE?(H=X.startContainer.getBoundingClientRect(),V.left=H.left,V.top=H.top):X.collapsed?H=X.getClientRects()[0]:H=X.getBoundingClientRect())}else if('string'==typeof D&&-1<D.indexOf('#')){var Y=D.substring(D.indexOf('#')+1),J=this.document.getElementById(Y);J&&(H=J.getBoundingClientRect())}return H&&(V.left=H.left,V.top=H.top),V}}},{key:'addStylesheet',value:function(D){return new Promise(function(F){var X=!1,V;return this.document?(V=this.document.querySelector('link[href=\''+D+'\']'),V?void F(!0):void(V=this.document.createElement('link'),V.type='text/css',V.rel='stylesheet',V.href=D,V.onload=V.onreadystatechange=function(){var Y=this;X||this.readyState&&'complete'!=this.readyState||(X=!0,setTimeout(function(){Y.pane&&Y.pane.render(),F(!0)},1))},this.document.head.appendChild(V))):void F(!1)}.bind(this))}},{key:'addStylesheetRules',value:function(D){var V='epubjs-inserted-css',F,H;if(this.document&&D&&0!==D.length){if(F=this.document.getElementById('#'+V),F||(F=this.document.createElement('style'),F.id=V),this.document.head.appendChild(F),H=F.sheet,'[object Array]'===Object.prototype.toString.call(D))for(var X=0,Y=D.length;X<Y;X++){var J=1,Z=D[X],Q=D[X][0],K='';'[object Array]'===Object.prototype.toString.call(Z[1][0])&&(Z=Z[1],J=0);for(var G=Z.length,$;J<G;J++)$=Z[J],K+=$[0]+':'+$[1]+($[2]?' !important':'')+';\n';H.insertRule(Q+'{'+K+'}',H.cssRules.length)}else{var ee=Object.keys(D);ee.forEach(function(te){var ne=D[te];if(Array.isArray(ne))ne.forEach(function(se){var re=Object.keys(se),le=re.map(function(oe){return oe+':'+se[oe]}).join(';');H.insertRule(te+'{'+le+'}',H.cssRules.length)});else{var ae=Object.keys(ne),ie=ae.map(function(se){return se+':'+ne[se]}).join(';');H.insertRule(te+'{'+ie+'}',H.cssRules.length)}})}this.pane&&this.pane.render()}}},{key:'addScript',value:function(D){return new Promise(function(F){var X=!1,V;return this.document?void(V=this.document.createElement('script'),V.type='text/javascript',V.async=!0,V.src=D,V.onload=V.onreadystatechange=function(){X||this.readyState&&'complete'!=this.readyState||(X=!0,setTimeout(function(){F(!0)},1))},this.document.head.appendChild(V)):void F(!1)}.bind(this))}},{key:'addClass',value:function(D){var F;this.document&&(F=this.content||this.document.body,F.classList.add(D))}},{key:'removeClass',value:function(D){var F;this.document&&(F=this.content||this.document.body,F.classList.remove(D))}},{key:'addEventListeners',value:function(){this.document&&I.forEach(function(D){this.document.addEventListener(D,this.triggerEvent.bind(this),!1)},this)}},{key:'removeEventListeners',value:function(){this.document&&I.forEach(function(D){this.document.removeEventListener(D,this.triggerEvent,!1)},this)}},{key:'triggerEvent',value:function(D){this.emit(D.type,D)}},{key:'addSelectionListeners',value:function(){this.document&&this.document.addEventListener('selectionchange',this.onSelectionChange.bind(this),!1)}},{key:'removeSelectionListeners',value:function(){this.document&&this.document.removeEventListener('selectionchange',this.onSelectionChange,!1)}},{key:'onSelectionChange',value:function(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var F=this.window.getSelection();this.triggerSelectedEvent(F)}.bind(this),250)}},{key:'triggerSelectedEvent',value:function(D){var F,H;D&&0<D.rangeCount&&(F=D.getRangeAt(0),!F.collapsed&&(H=new z.default(F,this.cfiBase).toString(),this.emit('selected',H),this.emit('selectedRange',F)))}},{key:'range',value:function(D,F){var H=new z.default(D);return H.toRange(this.document,F)}},{key:'cfiFromRange',value:function(D,F){return new z.default(D,this.cfiBase,F).toString()}},{key:'cfiFromNode',value:function(D,F){return new z.default(D,this.cfiBase,F).toString()}},{key:'map',value:function(D){var W=new A.default(D);return W.section()}},{key:'size',value:function(D,F){var H={scale:1,scalable:'no'};0<=D&&(this.width(D),H.width=D),0<=F&&(this.height(F),H.height=F),this.css('margin','0'),this.css('box-sizing','border-box'),this.viewport(H)}},{key:'columns',value:function(D,F,H,V){var X=(0,R.prefixed)('column-axis'),Y=(0,R.prefixed)('column-gap'),J=(0,R.prefixed)('column-width'),Z=(0,R.prefixed)('column-fill');this.width(D),this.height(F),this.viewport({width:D,height:F,scale:1,scalable:'no'}),this.css('display','inline-block'),this.css('overflow-y','hidden'),this.css('margin','0',!0),this.css('padding','0',!0),this.css('box-sizing','border-box'),this.css('max-width','inherit'),this.css(X,'horizontal'),this.css(Z,'auto'),this.css(Y,V+'px'),this.css(J,H+'px')}},{key:'scaler',value:function(D,F,H){var X='';this.css('transform-origin','top left'),(0<=F||0<=H)&&(X=' translate('+(F||0)+'px, '+(H||0)+'px )'),this.css('transform','scale('+D+')'+X)}},{key:'fit',value:function(D,F){var H=this.viewport(),V=D/H.width,X=F/H.height,Y=V<X?V:X,J=(F-H.height*Y)/2;this.width(D),this.height(F),this.overflow('hidden'),this.viewport({width:D,height:F,scale:1}),this.scaler(Y,0,J),this.css('background-color','transparent')}},{key:'mapPage',value:function(D,F,H,V,X){var Y=new A.default(F,X);return Y.page(this,D,H,V)}},{key:'linksHandler',value:function(){var D=this;(0,B.replaceLinks)(this.content,function(F){D.emit('linkClicked',F)})}},{key:'highlight',value:function(D){var F=this,H=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},V=arguments[2],X=this.range(D),Y=function(){F.emit('markClicked',D,H)};H.epubcfi=D,this.pane||(this.pane=new O.Pane(this.content,this.document.body));var J=new O.Highlight(X,'epubjs-hl',H,{fill:'yellow',"fill-opacity":'0.3',"mix-blend-mode":'multiply'}),Z=this.pane.addMark(J);return this.highlights[D]={mark:Z,element:Z.element,listeners:[Y,V]},Z.element.addEventListener('click',Y),V&&Z.element.addEventListener('click',V),Z}},{key:'underline',value:function(D){var F=this,H=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},V=arguments[2],X=this.range(D),Y=function(){F.emit('markClicked',D,H)};H.epubcfi=D,this.pane||(this.pane=new O.Pane(this.content,this.document.body));var J=new O.Underline(X,'epubjs-ul',H,{stroke:'black',"stroke-opacity":'0.3',"mix-blend-mode":'multiply'}),Z=this.pane.addMark(J);return this.underlines[D]={mark:Z,element:Z.element,listeners:[Y,V]},Z.element.addEventListener('click',Y),V&&Z.element.addEventListener('click',V),Z}},{key:'mark',value:function(D){var F=this,H=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},V=arguments[2],X=this.range(D),Y=X.commonAncestorContainer,J=1===Y.nodeType?Y:Y.parentNode,Z=function(){F.emit('markClicked',D,H)};return J.setAttribute('ref','epubjs-mk'),J.dataset.epubcfi=D,H&&Object.keys(H).forEach(function(Q){J.dataset[Q]=H[Q]}),J.addEventListener('click',Z),V&&J.addEventListener('click',V),this.marks[D]={element:J,listeners:[Z,V]},J}},{key:'unhighlight',value:function(D){var F;D in this.highlights&&(F=this.highlights[D],this.pane.removeMark(F.mark),F.listeners.forEach(function(H){H&&F.element.removeEventListener('click',H)}),delete this.highlights[D])}},{key:'ununderline',value:function(D){var F;D in this.underlines&&(F=this.underlines[D],this.pane.removeMark(F.mark),F.listeners.forEach(function(H){H&&F.element.removeEventListener('click',H)}),delete this.underlines[D])}},{key:'unmark',value:function(D){var F;D in this.marks&&(F=this.marks[D],F.element.removeAttribute('ref'),F.listeners.forEach(function(H){H&&F.element.removeEventListener('click',H)}),delete this.marks[D])}},{key:'destroy',value:function(){this.observer&&this.observer.disconnect(),this.document.removeEventListener('transitionend',this.resizeCheck),this.removeListeners()}}],[{key:'listenedEvents',get:function(){return I}}]),U}();(0,L.default)(M.prototype),k.default=M,v.exports=k['default']},function(v,k,_){'use strict';function S(T,z){if(!(T instanceof z))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function T(z,N){for(var A=0,B;A<N.length;A++)B=N[A],B.enumerable=B.enumerable||!1,B.configurable=!0,'value'in B&&(B.writable=!0),Object.defineProperty(z,B.key,B)}return function(z,N,A){return N&&T(z.prototype,N),A&&T(z,A),z}}(),P=_(1),L=function(T){return T&&T.__esModule?T:{default:T}}(P),R=function(){function T(z,N){S(this,T),this.layout=z,this.horizontal='paginated'===this.layout.flow,this._dev=N}return E(T,[{key:'section',value:function(N){var A=this.findRanges(N),B=this.rangeListToCfiList(N.section.cfiBase,A);return B}},{key:'page',value:function(N,A,B,O){var I=N&&N.document&&N.document.body,M;if(I){if(M=this.rangePairToCfiPair(A,{start:this.findStart(I,B,O),end:this.findEnd(I,B,O)}),!0===this._dev){var U=N.document,W=new L.default(M.start).toRange(U),D=new L.default(M.end).toRange(U),F=U.defaultView.getSelection(),H=U.createRange();F.removeAllRanges(),H.setStart(W.startContainer,W.startOffset),H.setEnd(D.endContainer,D.endOffset),F.addRange(H)}return M}}},{key:'walk',value:function(N,A){if(!(N&&N.nodeType===Node.TEXT_NODE)){var B={acceptNode:function(D){return 0<D.data.trim().length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},O=B.acceptNode;O.acceptNode=B.acceptNode;for(var I=document.createTreeWalker(N,NodeFilter.SHOW_TEXT,O,!1),M,U;(M=I.nextNode())&&(U=A(M),!U););return U}}},{key:'findRanges',value:function(N){for(var A=[],B=N.contents.scrollWidth(),O=Math.ceil(B/this.layout.spreadWidth),I=O*this.layout.divisor,M=this.layout.columnWidth,U=this.layout.gap,F=0,W,D;F<I.pages;F++)W=(M+U)*F,D=M*(F+1)+U*F,A.push({start:this.findStart(N.document.body,W,D),end:this.findEnd(N.document.body,W,D)});return A}},{key:'findStart',value:function(N,A,B){for(var O=this,I=[N],W=N,M,U;I.length;)if(M=I.shift(),U=this.walk(M,function(D){var F,H,V,X;return(D.nodeType==Node.TEXT_NODE?(X=document.createRange(),X.selectNodeContents(D),V=X.getBoundingClientRect()):V=D.getBoundingClientRect(),F=O.horizontal?V.left:V.top,H=O.horizontal?V.right:V.bottom,F>=A&&F<=B)?D:H>A?D:void(W=D,I.push(D))}),U)return this.findTextStartRange(U,A,B);return this.findTextStartRange(W,A,B)}},{key:'findEnd',value:function(N,A,B){for(var O=this,I=[N],U=N,M,W;I.length;)if(M=I.shift(),W=this.walk(M,function(D){var F,H,V,X;return(D.nodeType==Node.TEXT_NODE?(X=document.createRange(),X.selectNodeContents(D),V=X.getBoundingClientRect()):V=D.getBoundingClientRect(),F=Math.round(O.horizontal?V.left:V.top),H=Math.round(O.horizontal?V.right:V.bottom),F>B&&U)?U:H>B?D:void(U=D,I.push(D))}),W)return this.findTextEndRange(W,A,B);return this.findTextEndRange(U,A,B)}},{key:'findTextStartRange',value:function(N,A){for(var O=this.splitTextNodeIntoRanges(N),W=0,I,M,U;W<O.length;W++)if(I=O[W],M=I.getBoundingClientRect(),U=this.horizontal?M.left:M.top,U>=A)return I;return O[0]}},{key:'findTextEndRange',value:function(N,A,B){for(var O=this.splitTextNodeIntoRanges(N),F=0,I,M,U,W,D;F<O.length;F++){if(M=O[F],U=M.getBoundingClientRect(),W=this.horizontal?U.left:U.top,D=this.horizontal?U.right:U.bottom,W>B&&I)return I;if(D>B)return M;I=M}return O[O.length-1]}},{key:'splitTextNodeIntoRanges',value:function(N,A){var B=[],O=N.textContent||'',I=O.trim(),U=N.ownerDocument,W=A||' ',D=I.indexOf(W),M;if(-1===D||N.nodeType!=Node.TEXT_NODE)return M=U.createRange(),M.selectNodeContents(N),[M];for(M=U.createRange(),M.setStart(N,0),M.setEnd(N,D),B.push(M),M=!1;-1!=D;)D=I.indexOf(W,D+1),0<D&&(M&&(M.setEnd(N,D),B.push(M)),M=U.createRange(),M.setStart(N,D+1));return M&&(M.setEnd(N,I.length),B.push(M)),B}},{key:'rangePairToCfiPair',value:function(N,A){var B=A.start,O=A.end;B.collapse(!0),O.collapse(!1);var I=new L.default(B,N).toString(),M=new L.default(O,N).toString();return{start:I,end:M}}},{key:'rangeListToCfiList',value:function(N,A){for(var B=[],I=0,O;I<A.length;I++)O=this.rangePairToCfiPair(N,A[I]),B.push(O);return B}}]),T}();k.default=R,v.exports=k['default']},function(v,k){'use strict';function C(P,L){if(!(P instanceof L))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function P(L,R){for(var T=0,z;T<R.length;T++)z=R[T],z.enumerable=z.enumerable||!1,z.configurable=!0,'value'in z&&(z.writable=!0),Object.defineProperty(L,z.key,z)}return function(L,R,T){return R&&P(L.prototype,R),T&&P(L,T),L}}(),E=function(){function P(L){C(this,P),this.context=L||this,this.hooks=[]}return S(P,[{key:'register',value:function(){for(var R=0;R<arguments.length;++R)if('function'==typeof arguments[R])this.hooks.push(arguments[R]);else for(var T=0;T<arguments[R].length;++T)this.hooks.push(arguments[R][T])}},{key:'trigger',value:function(){var R=arguments,T=this.context,z=[];return this.hooks.forEach(function(N){var A=N.apply(T,R);A&&'function'==typeof A.then&&z.push(A)}),Promise.all(z)}},{key:'list',value:function(){return this.hooks}},{key:'clear',value:function(){return this.hooks=[]}}]),P}();k.default=E,v.exports=k['default']},function(v,k,_){'use strict';function C(R,T){if(!(R instanceof T))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0}),k.Task=void 0;var S=function(){function R(T,z){for(var N=0,A;N<z.length;N++)A=z[N],A.enumerable=A.enumerable||!1,A.configurable=!0,'value'in A&&(A.writable=!0),Object.defineProperty(T,A.key,A)}return function(T,z,N){return z&&R(T.prototype,z),N&&R(T,N),T}}(),E=_(0),P=function(){function R(T){C(this,R),this._q=[],this.context=T,this.tick=E.requestAnimationFrame,this.running=!1,this.paused=!1}return S(R,[{key:'enqueue',value:function(){var B=[].shift.call(arguments),O=arguments,z,N,A;if(!B)throw new Error('No Task Provided');return'function'==typeof B?(z=new E.defer,N=z.promise,A={task:B,args:O,deferred:z,promise:N}):A={promise:B},this._q.push(A),!1!=this.paused||this.running||this.run(),A.promise}},{key:'dequeue',value:function(){var z,N,A;if(this._q.length&&!this.paused){if(z=this._q.shift(),N=z.task,N)return A=N.apply(this.context,z.args),A&&'function'==typeof A.then?A.then(function(){z.deferred.resolve.apply(this.context,arguments)}.bind(this),function(){z.deferred.reject.apply(this.context,arguments)}.bind(this)):(z.deferred.resolve.apply(this.context,A),z.promise);if(z.promise)return z.promise}else return z=new E.defer,z.deferred.resolve(),z.promise}},{key:'dump',value:function(){for(;this._q.length;)this.dequeue()}},{key:'run',value:function(){var z=this;return this.running||(this.running=!0,this.defered=new E.defer),this.tick.call(window,function(){z._q.length?z.dequeue().then(function(){this.run()}.bind(z)):(z.defered.resolve(),z.running=void 0)}),!0==this.paused&&(this.paused=!1),this.defered.promise}},{key:'flush',value:function(){return this.running?this.running:this._q.length?(this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running):void 0}},{key:'clear',value:function(){this._q=[],this.running=!1,this.paused=!0}},{key:'length',value:function(){return this._q.length}},{key:'pause',value:function(){this.paused=!0}}]),R}();k.default=P,k.Task=function R(T,z,N){return C(this,R),function(){var A=this,B=arguments||[];return new Promise(function(O,I){B.push(function(W,D){!W&&D?I(D):O(W)}),T.apply(N||A,B)})}}},function(v,k,_){'use strict';Object.defineProperty(k,'__esModule',{value:!0});var E=_(0),P=_(3),L=function(R){return R&&R.__esModule?R:{default:R}}(P);k.default=function(R,T,z,N){function A(F){M.reject(F)}function B(){if(this.readyState===XMLHttpRequest.DONE){var F=!1;if((''===this.responseType||'document'===this.responseType)&&(F=this.responseXML),200===this.status||F){var H;if(!this.response&&!F)return M.reject({status:this.status,message:'Empty Response',stack:new Error().stack}),M.promise;if(403===this.status)return M.reject({status:this.status,response:this.response,message:'Forbidden',stack:new Error().stack}),M.promise;H=F?this.responseXML:(0,E.isXml)(T)?(0,E.parse)(this.response,'text/xml'):'xhtml'==T?(0,E.parse)(this.response,'application/xhtml+xml'):'html'==T||'htm'==T?(0,E.parse)(this.response,'text/html'):'json'==T?JSON.parse(this.response):'blob'==T?O?this.response:new Blob([this.response]):this.response,M.resolve(H)}else M.reject({status:this.status,message:this.response,stack:new Error().stack})}}var O='undefined'!=typeof window&&window.URL,I=O?'blob':'arraybuffer',M=new E.defer,U=new XMLHttpRequest,W=XMLHttpRequest.prototype,D;for(D in'overrideMimeType'in W||Object.defineProperty(W,'overrideMimeType',{value:function(){}}),z&&(U.withCredentials=!0),U.onreadystatechange=B,U.onerror=A,U.open('GET',R,!0),N)U.setRequestHeader(D,N[D]);return'json'==T&&U.setRequestHeader('Accept','application/json'),T||(T=new L.default(R).extension),'blob'==T&&(U.responseType=I),(0,E.isXml)(T)&&U.overrideMimeType('text/xml'),'xhtml'==T,'html'!=T&&'htm'!=T,'binary'==T&&(U.responseType='arraybuffer'),U.send(),M.promise},v.exports=k['default']},function(v,k,_){'use strict';var C=_(41)();v.exports=function(S){return S!==C&&null!==S}},function(v,k,_){'use strict';function C(W){return W&&W.__esModule?W:{default:W}}function S(W,D){if(!(W instanceof D))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function W(D,F){for(var H=0,V;H<F.length;H++)V=F[H],V.enumerable=V.enumerable||!1,V.configurable=!0,'value'in V&&(V.writable=!0),Object.defineProperty(D,V.key,V)}return function(D,F,H){return F&&W(D.prototype,F),H&&W(D,H),D}}(),P=_(2),L=C(P),R=_(0),T=_(8),z=C(T),N=_(10),A=C(N),B=_(31),O=C(B),I=_(32),M=C(I),U=function(){function W(D){S(this,W),this.name='default',this.View=D.view,this.request=D.request,this.renditionQueue=D.queue,this.q=new A.default(this),this.settings=(0,R.extend)(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:'vertical',ignoreClass:''}),(0,R.extend)(this.settings,D.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,layout:this.layout,width:0,height:0}}return E(W,[{key:'render',value:function(F,H){this.stage=new O.default({width:H.width,height:H.height,overflow:this.settings.overflow,hidden:this.settings.hidden,axis:this.settings.axis}),this.stage.attachTo(F),this.container=this.stage.getContainer(),this.views=new M.default(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout()}},{key:'addEventListeners',value:function(){var F;window.addEventListener('unload',function(){this.destroy()}.bind(this)),F=this.settings.height?this.container:window,F.addEventListener('scroll',this.onScroll.bind(this))}},{key:'removeEventListeners',value:function(){var F;F=this.settings.height?this.container:window,F.removeEventListener('scroll',this.onScroll.bind(this))}},{key:'destroy',value:function(){this.removeEventListeners(),this.views.each(function(F){F.destroy()}),this.stage.destroy()}},{key:'onResized',value:function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.resize()}.bind(this),150)}},{key:'resize',value:function(F,H){this.q.clear(),this._stageSize=this.stage.size(F,H),this._bounds=this.bounds(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.views.each(function(V){V.size(this._stageSize.width,this._stageSize.height)}.bind(this)),this.emit('resized',{width:this.stage.width,height:this.stage.height})}},{key:'createView',value:function(F){return new this.View(F,this.viewSettings)}},{key:'display',value:function(F,H){var V=new R.defer,X=V.promise,Y=this.views.find(F);if(Y&&H){var J=Y.locationOf(H);return this.moveTo(J),V.resolve(),X}return this.clear(),this.add(F).then(function(Z){if(H){var Q=Z.locationOf(H);this.moveTo(Q)}}.bind(this)).then(function(){var Z;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(Z=F.next(),Z))return this.add(Z)}.bind(this)).then(function(){this.views.show(),V.resolve()}.bind(this)),X}},{key:'afterDisplayed',value:function(F){this.emit('added',F)}},{key:'afterResized',value:function(F){this.emit('resize',F.section)}},{key:'moveTo',value:function(F){var H=0,V=0;'vertical'===this.settings.axis?V=F.top:(H=Math.floor(F.left/this.layout.delta)*this.layout.delta,H+this.layout.delta>this.container.scrollWidth&&(H=this.container.scrollWidth-this.layout.delta)),this.scrollTo(H,V,!0)}},{key:'add',value:function(F){var H=this.createView(F);return this.views.append(H),H.onDisplayed=this.afterDisplayed.bind(this),H.onResize=this.afterResized.bind(this),H.display(this.request)}},{key:'append',value:function(F){var H=this.createView(F);return this.views.append(H),H.onDisplayed=this.afterDisplayed.bind(this),H.onResize=this.afterResized.bind(this),H.display(this.request)}},{key:'prepend',value:function(F){var H=this.createView(F);return this.views.prepend(H),H.onDisplayed=this.afterDisplayed.bind(this),H.onResize=this.afterResized.bind(this),H.display(this.request)}},{key:'next',value:function(){var D,F;if(this.views.length)return('horizontal'===this.settings.axis?(this.scrollLeft=this.container.scrollLeft,F=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,F<this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):F-this.layout.columnWidth===this.container.scrollWidth?(this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0),D=this.views.last().section.next()):D=this.views.last().section.next()):D=this.views.last().section.next(),D)?(this.clear(),this.append(D).then(function(){var H;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(H=D.next(),H))return this.append(H)}.bind(this)).then(function(){this.views.show()}.bind(this))):void 0}},{key:'prev',value:function(){var D,F;if(this.views.length)return('horizontal'===this.settings.axis?(this.scrollLeft=this.container.scrollLeft,F=this.container.scrollLeft,0<F?this.scrollBy(-this.layout.delta,0,!0):D=this.views.first().section.prev()):D=this.views.first().section.prev(),D)?(this.clear(),this.prepend(D).then(function(){var H;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(H=D.prev(),H))return this.prepend(H)}.bind(this)).then(function(){'horizontal'===this.settings.axis&&this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0),this.views.show()}.bind(this))):void 0}},{key:'current',value:function(){var F=this.visible();return F.length?F[F.length-1]:null}},{key:'clear',value:function(){this.views.hide(),this.scrollTo(0,0,!0),this.views.clear()}},{key:'currentLocation',value:function(){return this.location='vertical'===this.settings.axis?this.scrolledLocation():this.paginatedLocation(),this.location}},{key:'scrolledLocation',value:function(){var F=this,H=this.visible(),V=this.container.getBoundingClientRect(),X=V.height<window.innerHeight?V.height:window.innerHeight,Y=0;this.settings.height||(Y=window.scrollY);var J=H.map(function(Z){var Q=Z.section,K=Q.index,G=Q.href,$=Z.position(),ee=$.top-V.top+Y,te=ee+X;te>$.bottom-V.top+Y&&(te=$.bottom-V.top+Y);for(var ne=F.layout.count(Z._height,X).pages,ae=Math.round(ee/X),ie=[],se=(te-ee)/X,re=1,le;re<=se;re++)le=ae+re,ie.push(le);var oe=F.mapping.page(Z.contents,Z.section.cfiBase,ee,te);return{index:K,href:G,pages:ie,totalPages:ne,mapping:oe}});return J}},{key:'paginatedLocation',value:function(){var F=this,H=this.visible(),V=this.container.getBoundingClientRect(),X=H.map(function(Y){var J=Y.section,Z=J.index,Q=J.href,K=Y.offset().left,G=Y.position().left,$=Y.width(),ee=F.container.scrollLeft+K,te=ee+F.layout.spreadWidth+F.layout.gap;te>F.container.scrollLeft+K+$&&(te=F.container.scrollLeft+K+$);for(var ne=F.layout.count($).pages,ae=Math.ceil((ee-K)/F.layout.spreadWidth),ie=[],se=(te-ee)/(F.layout.columnWidth+F.layout.gap/2),re=1,le;re<=se;re++)le=ae+re,ie.push(le);var oe=V.left-G,de=oe+F.layout.spreadWidth+F.layout.gap,ue=F.mapping.page(Y.contents,Y.section.cfiBase,oe,de);return{index:Z,href:Q,pages:ie,totalPages:ne,mapping:ue}});return X}},{key:'isVisible',value:function(F,H,V,X){var Y=F.position(),J=X||this.bounds();return'horizontal'===this.settings.axis&&Y.right>J.left-H&&Y.left<J.right+V||'vertical'===this.settings.axis&&Y.bottom>J.top-H&&Y.top<J.bottom+V}},{key:'visible',value:function(){for(var F=this.bounds(),H=this.views.displayed(),V=H.length,D=[],J=0,X,Y;J<V;J++)Y=H[J],X=this.isVisible(Y,0,0,F),!0===X&&D.push(Y);return D}},{key:'scrollBy',value:function(F,H,V){V&&(this.ignore=!0),this.settings.height?(F&&(this.container.scrollLeft+=F),H&&(this.container.scrollTop+=H)):window.scrollBy(F,H),this.scrolled=!0}},{key:'scrollTo',value:function(F,H,V){V&&(this.ignore=!0),this.settings.height?(this.container.scrollLeft=F,this.container.scrollTop=H):window.scrollTo(F,H),this.scrolled=!0}},{key:'onScroll',value:function(){var F,H;this.settings.height?(F=this.container.scrollTop,H=this.container.scrollLeft):(F=window.scrollY,H=window.scrollX),this.scrollTop=F,this.scrollLeft=H,this.ignore?this.ignore=!1:(this.emit('scroll',{top:F,left:H}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit('scrolled',{top:this.scrollTop,left:this.scrollLeft})}.bind(this),20))}},{key:'bounds',value:function(){var D;return D=this.stage.bounds(),D}},{key:'applyLayout',value:function(F){this.layout=F,this.updateLayout(),this.mapping=new z.default(this.layout.props)}},{key:'updateLayout',value:function(){this.stage&&(this._stageSize=this.stage.size(),'vertical'===this.settings.axis?this.layout.calculate(this._stageSize.width,this._stageSize.height):(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta,this.stage.addStyleRules('iframe',[{"margin-right":this.layout.gap+'px'}])),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}},{key:'setLayout',value:function(F){this.viewSettings.layout=F,this.views&&this.views.each(function(H){H.setLayout(F)})}},{key:'updateFlow',value:function(F){var H='paginated'===F?'horizontal':'vertical';this.settings.axis=H,this.viewSettings.axis=H,this.settings.overflow='paginated'===F?'hidden':'auto'}},{key:'getContents',value:function(){var F=[];return this.views.each(function(H){F.push(H.contents)}),F}}]),W}();(0,L.default)(U.prototype),k.default=U,v.exports=k['default']},function(v,k,_){'use strict';function C(Q){return Q&&Q.__esModule?Q:{default:Q}}function S(Q,K){if(!(Q instanceof K))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(Q){return typeof Q}:function(Q){return Q&&'function'==typeof Symbol&&Q.constructor===Symbol&&Q!==Symbol.prototype?'symbol':typeof Q},P=function(){function Q(K,G){for(var $=0,ee;$<G.length;$++)ee=G[$],ee.enumerable=ee.enumerable||!1,ee.configurable=!0,'value'in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}return function(K,G,$){return G&&Q(K.prototype,G),$&&Q(K,$),K}}(),L=_(2),R=C(L),T=_(0),z=_(9),N=C(z),A=_(1),B=C(A),O=_(10),I=C(O),M=_(29),U=C(M),W=_(8),D=C(W),F=_(39),H=C(F),V=_(7),X=C(V),Y=_(25),J=C(Y),Z=function(){function Q(K,G){S(this,Q),this.settings=(0,T.extend)(this.settings||{},{width:null,height:null,ignoreClass:'',manager:'default',view:'iframe',flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,script:null}),(0,T.extend)(this.settings,G),'object'===E(this.settings.manager)&&(this.manager=this.settings.manager),this.viewSettings={ignoreClass:this.settings.ignoreClass},this.book=K,this.views=null,this.hooks={},this.hooks.display=new N.default(this),this.hooks.serialize=new N.default(this),this.hooks.content=new N.default(this),this.hooks.unloaded=new N.default(this),this.hooks.layout=new N.default(this),this.hooks.render=new N.default(this),this.hooks.show=new N.default(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.spine.hooks.content.register(this.injectSource.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new H.default(this),this.annotations=new J.default(this),this.epubcfi=new B.default,this.q=new I.default(this),this.q.enqueue(this.book.opened),this.starting=new T.defer,this.started=this.starting.promise,this.q.enqueue(this.start)}return P(Q,[{key:'setManager',value:function(G){this.manager=G}},{key:'requireManager',value:function(G){var $;return $='string'==typeof G?'undefined'==typeof ePub?void 0:ePub.ViewManagers[G]:G,$}},{key:'requireView',value:function(G){var $;return $='string'==typeof G?'undefined'==typeof ePub?void 0:ePub.Views[G]:G,$}},{key:'start',value:function(){this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on('added',this.afterDisplayed.bind(this)),this.manager.on('removed',this.afterRemoved.bind(this)),this.manager.on('resized',this.onResized.bind(this)),this.manager.on('scrolled',this.reportLocation.bind(this)),this.emit('started'),this.starting.resolve()}},{key:'attachTo',value:function(G){return this.q.enqueue(function(){this.manager.render(G,{width:this.settings.width,height:this.settings.height}),this.emit('attached')}.bind(this))}},{key:'display',value:function(G){return this.q.enqueue(this._display,G)}},{key:'_display',value:function(G){if(this.book){var $=this.epubcfi.isCfiString(G),ee=new T.defer,te=ee.promise,ne;return this.book.locations.length&&((0,T.isFloat)(G)||'string'==typeof G&&G==parseFloat(G))&&(G=this.book.locations.cfiFromPercentage(parseFloat(G))),ne=this.book.spine.get(G),ne?this.manager.display(ne,G).then(function(){this.emit('displayed',ne),this.reportLocation()}.bind(this)):(ee.reject(new Error('No Section Found')),te)}}},{key:'afterDisplayed',value:function(G){var $=this;this.hooks.content.trigger(G.contents,this).then(function(){$.emit('rendered',G.section,G)})}},{key:'afterRemoved',value:function(G){var $=this;this.hooks.unloaded.trigger(G,this).then(function(){$.emit('removed',G.section,G)})}},{key:'onResized',value:function(G){this.location&&this.display(this.location.start.cfi),this.emit('resized',{width:G.width,height:G.height})}},{key:'moveTo',value:function(G){this.manager.moveTo(G)}},{key:'next',value:function(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:'prev',value:function(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:'determineLayoutProperties',value:function(G){var ee=this.settings.layout||G.layout||'reflowable',te=this.settings.spread||G.spread||'auto',ne=this.settings.orientation||G.orientation||'auto',ae=this.settings.flow||G.flow||'auto',ie=G.viewport||'',se=this.settings.minSpreadWidth||G.minSpreadWidth||800,$;return 0<=this.settings.width&&0<=this.settings.height&&(ie='width='+this.settings.width+', height='+this.settings.height+''),$={layout:ee,spread:te,orientation:ne,flow:ae,viewport:ie,minSpreadWidth:se},$}},{key:'flow',value:function(G){var $=G;('scrolled'===G||'scrolled-doc'===G||'scrolled-continuous'===G)&&($='scrolled'),('auto'===G||'paginated'===G)&&($='paginated'),this.settings.flow=G,this._layout&&this._layout.flow($),this.manager&&this.manager.updateFlow($)}},{key:'layout',value:function(G){return G&&(this._layout=new U.default(G),this._layout.spread(G.spread,this.settings.minSpreadWidth),this.mapping=new D.default(this._layout.props)),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}},{key:'spread',value:function(G,$){this._layout.spread(G,$),this.manager.isRendered()&&this.manager.updateLayout()}},{key:'reportLocation',value:function(){return this.q.enqueue(function(){var G=this.manager.currentLocation();if(G&&G.then&&'function'==typeof G.then)G.then(function(ee){var te=this.located(ee);this.location=te,this.emit('locationChanged',{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit('relocated',this.location)}.bind(this));else if(G){var $=this.located(G);this.location=$,this.emit('locationChanged',{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit('relocated',this.location)}}.bind(this))}},{key:'currentLocation',value:function(){var G=this.manager.currentLocation();if(G&&G.then&&'function'==typeof G.then)G.then(function(ee){var te=this.located(ee);return te}.bind(this));else if(G){var $=this.located(G);return $}}},{key:'located',value:function(G){var $=G[0],ee=G[G.length-1],K={start:{index:$.index,href:$.href,cfi:$.mapping.start,displayed:{page:$.pages[0],total:$.totalPages}},end:{index:ee.index,href:ee.href,cfi:ee.mapping.end,displayed:{page:ee.pages[ee.pages.length-1],totalPages:ee.totalPages}}},te=this.book.locations.locationFromCfi($.mapping.start),ne=this.book.locations.locationFromCfi(ee.mapping.end);null!=te&&(K.start.location=te,K.start.percentage=this.book.locations.percentageFromLocation(te)),null!=ne&&(K.end.location=ne,K.end.percentage=this.book.locations.percentageFromLocation(ne));var ae=this.book.pageList.pageFromCfi($.mapping.start),ie=this.book.pageList.pageFromCfi(ee.mapping.end);return-1!=ae&&(K.start.page=ae),-1!=ie&&(K.end.page=ie),ee.index===this.book.spine.last().index&&K.end.displayed.page===K.end.displayed.totalPages&&(K.atEnd=!0),$.index===this.book.spine.first().index&&1===K.start.displayed.page&&(K.atStart=!0),K}},{key:'destroy',value:function(){this.manager&&this.manager.destroy(),this.book=void 0,this.views=null}},{key:'passEvents',value:function(G){var $=this,ee=X.default.listenedEvents;ee.forEach(function(te){G.on(te,function(ne){return $.triggerViewEvent(ne,G)})}),G.on('selected',function(te){return $.triggerSelectedEvent(te,G)}),G.on('markClicked',function(te,ne){return $.triggerMarkEvent(te,ne,G)})}},{key:'triggerViewEvent',value:function(G,$){this.emit(G.type,G,$)}},{key:'triggerSelectedEvent',value:function(G,$){this.emit('selected',G,$)}},{key:'triggerMarkEvent',value:function(G,$,ee){this.emit('markClicked',G,$,ee)}},{key:'getRange',value:function(G,$){var ee=new B.default(G),te=this.manager.visible().filter(function(ne){if(ee.spinePos===ne.index)return!0});if(te.length)return te[0].contents.range(ee,$)}},{key:'adjustImages',value:function(G){return'pre-paginated'===this._layout.name?new Promise(function($){$()}):(G.addStylesheetRules({img:{"max-width":(this._layout.columnWidth?this._layout.columnWidth+'px':'100%')+'!important',"max-height":(this._layout.height?0.6*this._layout.height+'px':'60%')+'!important',"object-fit":'contain',"page-break-inside":'avoid'}}),new Promise(function($){setTimeout(function(){$()},1)}))}},{key:'getContents',value:function(){return this.manager?this.manager.getContents():[]}},{key:'handleLinks',value:function(G){var $=this;G&&G.on('link',function(ee){var te=$.book.path.relative(ee);$.display(te)})}},{key:'injectStylesheet',value:function(G){var ee=G.createElement('link');ee.setAttribute('type','text/css'),ee.setAttribute('rel','stylesheet'),ee.setAttribute('href',this.settings.stylesheet),G.getElementsByTagName('head')[0].appendChild(ee)}},{key:'injectScript',value:function(G){var ee=G.createElement('script');ee.setAttribute('type','text/javascript'),ee.setAttribute('src',this.settings.script),ee.textContent=' ',G.getElementsByTagName('head')[0].appendChild(ee)}},{key:'injectSource',value:function(G){var ee=this.book.package.metadata.identifier,te=G.createElement('meta');te.setAttribute('property','dc:source'),ee&&te.setAttribute('contents',ee),G.getElementsByTagName('head')[0].appendChild(te)}}]),Q}();(0,R.default)(Z.prototype),k.default=Z,v.exports=k['default']},function(v){var _=function(){return this}();try{_=_||Function('return this')()||(1,eval)('this')}catch(C){'object'==typeof window&&(_=window)}v.exports=_},function(v){'use strict';var S={application:{ecmascript:['es','ecma'],javascript:'js',ogg:'ogx',pdf:'pdf',postscript:['ps','ai','eps','epsi','epsf','eps2','eps3'],"rdf+xml":'rdf',smil:['smi','smil'],"xhtml+xml":['xhtml','xht'],xml:['xml','xsl','xsd','opf','ncx'],zip:'zip',"x-httpd-eruby":'rhtml',"x-latex":'latex',"x-maker":['frm','maker','frame','fm','fb','book','fbdoc'],"x-object":'o',"x-shockwave-flash":['swf','swfl'],"x-silverlight":'scr',"epub+zip":'epub',"font-tdpfr":'pfr',"inkml+xml":['ink','inkml'],json:'json',"jsonml+json":'jsonml',"mathml+xml":'mathml',"metalink+xml":'metalink',mp4:'mp4s',"omdoc+xml":'omdoc',oxps:'oxps',"vnd.amazon.ebook":'azw',widget:'wgt',"x-dtbook+xml":'dtb',"x-dtbresource+xml":'res',"x-font-bdf":'bdf',"x-font-ghostscript":'gsf',"x-font-linux-psf":'psf',"x-font-otf":'otf',"x-font-pcf":'pcf',"x-font-snf":'snf',"x-font-ttf":['ttf','ttc'],"x-font-type1":['pfa','pfb','pfm','afm'],"x-font-woff":'woff',"x-mobipocket-ebook":['prc','mobi'],"x-mspublisher":'pub',"x-nzb":'nzb',"x-tgif":'obj',"xaml+xml":'xaml',"xml-dtd":'dtd',"xproc+xml":'xpl',"xslt+xml":'xslt',"internet-property-stream":'acx',"x-compress":'z',"x-compressed":'tgz',"x-gzip":'gz'},audio:{flac:'flac',midi:['mid','midi','kar','rmi'],mpeg:['mpga','mpega','mp2','mp3','m4a','mp2a','m2a','m3a'],mpegurl:'m3u',ogg:['oga','ogg','spx'],"x-aiff":['aif','aiff','aifc'],"x-ms-wma":'wma',"x-wav":'wav',adpcm:'adp',mp4:'mp4a',webm:'weba',"x-aac":'aac',"x-caf":'caf',"x-matroska":'mka',"x-pn-realaudio-plugin":'rmp',xm:'xm',mid:['mid','rmi']},image:{gif:'gif',ief:'ief',jpeg:['jpeg','jpg','jpe'],pcx:'pcx',png:'png',"svg+xml":['svg','svgz'],tiff:['tiff','tif'],"x-icon":'ico',bmp:'bmp',webp:'webp',"x-pict":['pic','pct'],"x-tga":'tga',"cis-cod":'cod'},text:{"cache-manifest":['manifest','appcache'],css:'css',csv:'csv',html:['html','htm','shtml','stm'],mathml:'mml',plain:['txt','text','brf','conf','def','list','log','in','bas'],richtext:'rtx',"tab-separated-values":'tsv',"x-bibtex":'bib'},video:{mpeg:['mpeg','mpg','mpe','m1v','m2v','mp2','mpa','mpv2'],mp4:['mp4','mp4v','mpg4'],quicktime:['qt','mov'],ogg:'ogv',"vnd.mpegurl":['mxu','m4u'],"x-flv":'flv',"x-la-asf":['lsf','lsx'],"x-mng":'mng',"x-ms-asf":['asf','asx','asr'],"x-ms-wm":'wm',"x-ms-wmv":'wmv',"x-ms-wmx":'wmx',"x-ms-wvx":'wvx',"x-msvideo":'avi',"x-sgi-movie":'movie',"x-matroska":['mpv','mkv','mk3d','mks'],"3gpp2":'3g2',h261:'h261',h263:'h263',h264:'h264',jpeg:'jpgv',jpm:['jpm','jpgm'],mj2:['mj2','mjp2'],"vnd.ms-playready.media.pyv":'pyv',"vnd.uvvu.mp4":['uvu','uvvu'],"vnd.vivo":'viv',webm:'webm',"x-f4v":'f4v',"x-m4v":'m4v',"x-ms-vob":'vob',"x-smv":'smv'}},E=function(){var N={},L,R,T,z;for(L in S)if(S.hasOwnProperty(L))for(R in S[L])if(S[L].hasOwnProperty(R))if(T=S[L][R],'string'==typeof T)N[T]=L+'/'+R;else for(z=0;z<T.length;z++)N[T[z]]=L+'/'+R;return N}();v.exports={lookup:function(L){return L&&E[L.split('.').pop().toLowerCase()]||'text/plain'}}},function(v){v.exports=s},function(v,k,_){'use strict';(function(C,S){var E,P,L,R='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(T){return typeof T}:function(T){return T&&'function'==typeof Symbol&&T.constructor===Symbol&&T!==Symbol.prototype?'symbol':typeof T};(function(T,z){T||(T=window||C),'object'===R(S)&&S.exports?S.exports=z(T):(P=[],E=z,L='function'==typeof E?E.apply(k,P):E,!(L!==void 0&&(S.exports=L)))})(void 0,function(T){function z(Z){return void 0!==F[Z]}function N(){M.call(this),this._isInvalid=!0}function A(Z){return''==Z&&N.call(this),Z.toLowerCase()}function B(Z){var Q=Z.charCodeAt(0);return 32<Q&&127>Q&&-1==[34,35,60,62,63,96].indexOf(Q)?Z:encodeURIComponent(Z)}function O(Z){var Q=Z.charCodeAt(0);return 32<Q&&127>Q&&-1==[34,35,60,62,96].indexOf(Q)?Z:encodeURIComponent(Z)}function I(Z,Q,K){function G(he){ie.push(he)}var $=Q||'scheme start',ee=0,te='',ne=!1,ae=!1,ie=[];loop:for(;(Z[ee-1]!=V||0==ee)&&!this._isInvalid;){var se=Z[ee];switch($){case'scheme start':if(se&&X.test(se))te+=se.toLowerCase(),$='scheme';else if(!Q){te='',$='no scheme';continue}else{G('Invalid scheme.');break loop}break;case'scheme':if(se&&Y.test(se))te+=se.toLowerCase();else if(':'==se){if(this._scheme=te,te='',Q)break loop;z(this._scheme)&&(this._isRelative=!0),$='file'==this._scheme?'relative':this._isRelative&&K&&K._scheme==this._scheme?'relative or authority':this._isRelative?'authority first slash':'scheme data'}else if(!Q){te='',ee=0,$='no scheme';continue}else if(V==se)break loop;else{G('Code point not allowed in scheme: '+se);break loop}break;case'scheme data':'?'==se?(this._query='?',$='query'):'#'==se?(this._fragment='#',$='fragment'):V!=se&&'\t'!=se&&'\n'!=se&&'\r'!=se&&(this._schemeData+=B(se));break;case'no scheme':if(!K||!z(K._scheme))G('Missing scheme.'),N.call(this);else{$='relative';continue}break;case'relative or authority':if('/'==se&&'/'==Z[ee+1])$='authority ignore slashes';else{G('Expected /, got: '+se),$='relative';continue}break;case'relative':if(this._isRelative=!0,'file'!=this._scheme&&(this._scheme=K._scheme),V==se){this._host=K._host,this._port=K._port,this._path=K._path.slice(),this._query=K._query,this._username=K._username,this._password=K._password;break loop}else if('/'==se||'\\'==se)'\\'==se&&G('\\ is an invalid code point.'),$='relative slash';else if('?'==se)this._host=K._host,this._port=K._port,this._path=K._path.slice(),this._query='?',this._username=K._username,this._password=K._password,$='query';else if('#'==se)this._host=K._host,this._port=K._port,this._path=K._path.slice(),this._query=K._query,this._fragment='#',this._username=K._username,this._password=K._password,$='fragment';else{var re=Z[ee+1],le=Z[ee+2];'file'==this._scheme&&X.test(se)&&(':'==re||'|'==re)&&(V==le||'/'==le||'\\'==le||'?'==le||'#'==le)||(this._host=K._host,this._port=K._port,this._username=K._username,this._password=K._password,this._path=K._path.slice(),this._path.pop()),$='relative path';continue}break;case'relative slash':if('/'==se||'\\'==se)'\\'==se&&G('\\ is an invalid code point.'),$='file'==this._scheme?'file host':'authority ignore slashes';else{'file'!=this._scheme&&(this._host=K._host,this._port=K._port,this._username=K._username,this._password=K._password),$='relative path';continue}break;case'authority first slash':if('/'==se)$='authority second slash';else{G('Expected \'/\', got: '+se),$='authority ignore slashes';continue}break;case'authority second slash':if($='authority ignore slashes','/'!=se){G('Expected \'/\', got: '+se);continue}break;case'authority ignore slashes':if('/'!=se&&'\\'!=se){$='authority';continue}else G('Expected authority, got: '+se);break;case'authority':if('@'==se){ne&&(G('@ already seen.'),te+='%40'),ne=!0;for(var oe=0,de;oe<te.length;oe++){if(de=te[oe],'\t'==de||'\n'==de||'\r'==de){G('Invalid whitespace in authority.');continue}if(':'==de&&null===this._password){this._password='';continue}var ue=B(de);null===this._password?this._username+=ue:this._password+=ue}te=''}else if(V==se||'/'==se||'\\'==se||'?'==se||'#'==se){ee-=te.length,te='',$='host';continue}else te+=se;break;case'file host':if(V==se||'/'==se||'\\'==se||'?'==se||'#'==se){2==te.length&&X.test(te[0])&&(':'==te[1]||'|'==te[1])?$='relative path':0==te.length?$='relative path start':(this._host=A.call(this,te),te='',$='relative path start');continue}else'\t'==se||'\n'==se||'\r'==se?G('Invalid whitespace in file host.'):te+=se;break;case'host':case'hostname':if(':'==se&&!ae){if(this._host=A.call(this,te),te='',$='port','hostname'==Q)break loop;}else if(V==se||'/'==se||'\\'==se||'?'==se||'#'==se){if(this._host=A.call(this,te),te='',$='relative path start',Q)break loop;continue}else'\t'!=se&&'\n'!=se&&'\r'!=se?('['==se?ae=!0:']'==se&&(ae=!1),te+=se):G('Invalid code point in host/hostname: '+se);break;case'port':if(/[0-9]/.test(se))te+=se;else if(V==se||'/'==se||'\\'==se||'?'==se||'#'==se||Q){if(''!=te){var ce=parseInt(te,10);ce!=F[this._scheme]&&(this._port=ce+''),te=''}if(Q)break loop;$='relative path start';continue}else'\t'==se||'\n'==se||'\r'==se?G('Invalid code point in port: '+se):N.call(this);break;case'relative path start':if('\\'==se&&G('\'\\\' not allowed in path.'),$='relative path','/'!=se&&'\\'!=se)continue;break;case'relative path':if(V==se||'/'==se||'\\'==se||!Q&&('?'==se||'#'==se)){'\\'==se&&G('\\ not allowed in relative path.');var pe;(pe=H[te.toLowerCase()])&&(te=pe),'..'==te?(this._path.pop(),'/'!=se&&'\\'!=se&&this._path.push('')):'.'==te&&'/'!=se&&'\\'!=se?this._path.push(''):'.'!=te&&('file'==this._scheme&&0==this._path.length&&2==te.length&&X.test(te[0])&&'|'==te[1]&&(te=te[0]+':'),this._path.push(te)),te='','?'==se?(this._query='?',$='query'):'#'==se&&(this._fragment='#',$='fragment')}else'\t'!=se&&'\n'!=se&&'\r'!=se&&(te+=B(se));break;case'query':Q||'#'!=se?V!=se&&'\t'!=se&&'\n'!=se&&'\r'!=se&&(this._query+=O(se)):(this._fragment='#',$='fragment');break;case'fragment':V!=se&&'\t'!=se&&'\n'!=se&&'\r'!=se&&(this._fragment+=se);}ee++}}function M(){this._scheme='',this._schemeData='',this._username='',this._password=null,this._host='',this._port='',this._path=[],this._query='',this._fragment='',this._isInvalid=!1,this._isRelative=!1}function U(Z,Q){void 0===Q||Q instanceof U||(Q=new U(Q+'')),this._url=Z,M.call(this);var K=Z.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,'');I.call(this,K,null,Q)}var W=!1;if(!T.forceJURL)try{var D=new URL('b','http://a');D.pathname='c%20d',W='http://a/c%20d'===D.href}catch(Z){}if(W)return T.URL;var F=Object.create(null);F.ftp=21,F.file=0,F.gopher=70,F.http=80,F.https=443,F.ws=80,F.wss=443;var H=Object.create(null);H['%2e']='.',H['.%2e']='..',H['%2e.']='..',H['%2e%2e']='..';var X=/[a-zA-Z]/,Y=/[a-zA-Z0-9\+\-\.]/,V;U.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var Z='';return(''!=this._username||null!=this._password)&&(Z=this._username+(null==this._password?'':':'+this._password)+'@'),this.protocol+(this._isRelative?'//'+Z+this.host:'')+this.pathname+this._query+this._fragment},set href(Z){M.call(this),I.call(this,Z)},get protocol(){return this._scheme+':'},set protocol(Z){this._isInvalid||I.call(this,Z+':','scheme start')},get host(){return this._isInvalid?'':this._port?this._host+':'+this._port:this._host},set host(Z){this._isInvalid||!this._isRelative||I.call(this,Z,'host')},get hostname(){return this._host},set hostname(Z){this._isInvalid||!this._isRelative||I.call(this,Z,'hostname')},get port(){return this._port},set port(Z){this._isInvalid||!this._isRelative||I.call(this,Z,'port')},get pathname(){return this._isInvalid?'':this._isRelative?'/'+this._path.join('/'):this._schemeData},set pathname(Z){this._isInvalid||!this._isRelative||(this._path=[],I.call(this,Z,'relative path start'))},get search(){return this._isInvalid||!this._query||'?'==this._query?'':this._query},set search(Z){this._isInvalid||!this._isRelative||(this._query='?','?'==Z[0]&&(Z=Z.slice(1)),I.call(this,Z,'query'))},get hash(){return this._isInvalid||!this._fragment||'#'==this._fragment?'':this._fragment},set hash(Z){this._isInvalid||(this._fragment='#','#'==Z[0]&&(Z=Z.slice(1)),I.call(this,Z,'fragment'))},get origin(){var Z;if(this._isInvalid||!this._scheme)return'';switch(this._scheme){case'file':return'file://';case'data':case'javascript':case'mailto':return'null';}return Z=this.host,Z?this._scheme+'://'+Z:''}};var J=T.URL;return J&&(U.createObjectURL=function(){return J.createObjectURL.apply(J,arguments)},U.revokeObjectURL=function(Z){J.revokeObjectURL(Z)}),U})}).call(k,_(15),_(55)(v))},function(v,k,_){'use strict';function C(oe){return oe&&oe.__esModule?oe:{default:oe}}function S(oe,de){if(!(oe instanceof de))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(oe){return typeof oe}:function(oe){return oe&&'function'==typeof Symbol&&oe.constructor===Symbol&&oe!==Symbol.prototype?'symbol':typeof oe},P=function(){function oe(de,ue){for(var ce=0,pe;ce<ue.length;ce++)pe=ue[ce],pe.enumerable=pe.enumerable||!1,pe.configurable=!0,'value'in pe&&(pe.writable=!0),Object.defineProperty(de,pe.key,pe)}return function(de,ue,ce){return ue&&oe(de.prototype,ue),ce&&oe(de,ce),de}}(),L=_(2),R=C(L),T=_(0),z=_(5),N=C(z),A=_(3),B=C(A),O=_(38),I=C(O),M=_(30),U=C(M),W=_(27),D=C(W),F=_(34),H=C(F),V=_(33),X=C(V),Y=_(36),J=C(Y),Z=_(35),Q=C(Z),K=_(14),G=C(K),$=_(26),ee=C($),te=_(11),ne=C(te),ae=_(1),ie=C(ae),se='META-INF/container.xml',le=function(){function oe(de,ue){var ce=this;S(this,oe),'undefined'==typeof ue&&'object'===('undefined'==typeof de?'undefined':E(de))&&(ue=de,de=void 0),this.settings=(0,T.extend)(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0}),(0,T.extend)(this.settings,ue),this.opening=new T.defer,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new T.defer,spine:new T.defer,metadata:new T.defer,cover:new T.defer,navigation:new T.defer,pageList:new T.defer,resources:new T.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources]),this.isRendered=!1,this.request=this.settings.requestMethod||ne.default,this.spine=new I.default,this.locations=new U.default(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=new Q.default,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,this.toc=void 0,de&&this.open(de).catch(function(){var he=new Error('Cannot load book at '+de);ce.emit('openFailed',he)})}return P(oe,[{key:'open',value:function(ue,ce){var he=ce||this.determineType(ue),pe;return'binary'===he?(this.archived=!0,this.url=new N.default('/',''),pe=this.openEpub(ue)):'base64'===he?(this.archived=!0,this.url=new N.default('/',''),pe=this.openEpub(ue,he)):'epub'===he?(this.archived=!0,this.url=new N.default('/',''),pe=this.request(ue,'binary').then(this.openEpub.bind(this))):'opf'==he?(this.url=new N.default(ue),pe=this.openPackaging(this.url.Path.toString())):'json'==he?(this.url=new N.default(ue),pe=this.openManifest(this.url.Path.toString())):(this.url=new N.default(ue),pe=this.openContainer(se).then(this.openPackaging.bind(this))),pe}},{key:'openEpub',value:function(ue,ce){var pe=this;return this.unarchive(ue,ce||this.settings.encoding).then(function(){return pe.openContainer(se)}).then(function(he){return pe.openPackaging(he)})}},{key:'openContainer',value:function(ue){var ce=this;return this.load(ue).then(function(pe){return ce.container=new D.default(pe),ce.resolve(ce.container.packagePath)})}},{key:'openPackaging',value:function(ue){var ce=this;return this.path=new B.default(ue),this.load(ue).then(function(pe){return ce.packaging=new H.default(pe),ce.unpack(ce.packaging)})}},{key:'openManifest',value:function(ue){var ce=this;return this.path=new B.default(ue),this.load(ue).then(function(pe){return ce.packaging=new H.default,ce.packaging.load(pe),ce.unpack(ce.packaging)})}},{key:'load',value:function(ue){var ce;return this.archived?(ce=this.resolve(ue),this.archive.request(ce)):(ce=this.resolve(ue),this.request(ce,null,this.settings.requestCredentials,this.settings.requestHeaders))}},{key:'resolve',value:function(ue,ce){if(ue){var pe=ue,he=-1<ue.indexOf('://');return he?ue:(this.path&&(pe=this.path.resolve(ue)),!1!=ce&&this.url&&(pe=this.url.resolve(pe)),pe)}}},{key:'determineType',value:function(ue){var ce,pe,he;return'base64'===this.settings.encoding?'base64':'string'==typeof ue?(ce=new N.default(ue),pe=ce.path(),he=pe.extension,he?'epub'===he?'epub':'opf'===he?'opf':'json'===he?'json':void 0:'directory'):'binary'}},{key:'unpack',value:function(ue){var ce=this;this.package=ue,this.spine.unpack(this.package,this.resolve.bind(this)),this.resources=new J.default(this.package.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||'base64'}),this.loadNavigation(this.package).then(function(){ce.toc=ce.navigation.toc,ce.loading.navigation.resolve(ce.navigation)}),this.package.coverPath&&(this.cover=this.resolve(this.package.coverPath)),this.loading.manifest.resolve(this.package.manifest),this.loading.metadata.resolve(this.package.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&'none'!=this.settings.replacements?this.replacements().then(function(){ce.opening.resolve(ce)}).catch(function(pe){console.error(pe)}):this.opening.resolve(this)}},{key:'loadNavigation',value:function(ue){var ce=this,pe=ue.navPath||ue.ncxPath,he=ue.toc;return he?new Promise(function(ge){ce.navigation=new X.default(he),ce.pageList=new Q.default,ge(ce.navigation)}):pe?this.load(pe,'xml').then(function(ge){return ce.navigation=new X.default(ge),ce.pageList=new Q.default(ge),ce.navigation}):new Promise(function(ge){ce.navigation=new X.default,ce.pageList=new Q.default,ge(ce.navigation)})}},{key:'section',value:function(ue){return this.spine.get(ue)}},{key:'renderTo',value:function(ue,ce){return this.rendition=new G.default(this,ce),this.rendition.attachTo(ue),this.rendition}},{key:'setRequestCredentials',value:function(ue){this.settings.requestCredentials=ue}},{key:'setRequestHeaders',value:function(ue){this.settings.requestHeaders=ue}},{key:'unarchive',value:function(ue,ce){return this.archive=new ee.default,this.archive.open(ue,ce)}},{key:'coverUrl',value:function(){var ue=this,ce=this.loaded.cover.then(function(){return ue.archived?ue.resources.get(ue.cover):ue.cover});return ce}},{key:'replacements',value:function(){var ue=this;return this.spine.hooks.serialize.register(function(ce,pe){pe.output=ue.resources.substitute(ce,pe.url)}),this.resources.replacements().then(function(){return ue.resources.replaceCss()})}},{key:'getRange',value:function(ue){var ce=new ie.default(ue),pe=this.spine.get(ce.spinePos),he=this.load.bind(this);return pe.load(he).then(function(){var fe=ce.toRange(pe.document);return fe})}},{key:'key',value:function(ue){var ce=ue||this.package.metadata.identifier||this.url.filename;return'epubjs:'+'0.3'+':'+ce}},{key:'destroy',value:function(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.toc=void 0}}]),oe}();(0,R.default)(le.prototype),k.default=le,v.exports=k['default']},function(v,k,_){'use strict';function S(A,B){if(!(A instanceof B))throw new TypeError('Cannot call a class as a function')}function E(A,B){if(!A)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return B&&('object'==typeof B||'function'==typeof B)?B:A}function P(A,B){if('function'!=typeof B&&null!==B)throw new TypeError('Super expression must either be null or a function, not '+typeof B);A.prototype=Object.create(B&&B.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(A,B):A.__proto__=B)}Object.defineProperty(k,'__esModule',{value:!0});var L=function(){function A(B,O){for(var I=0,M;I<O.length;I++)M=O[I],M.enumerable=M.enumerable||!1,M.configurable=!0,'value'in M&&(M.writable=!0),Object.defineProperty(B,M.key,M)}return function(B,O,I){return O&&A(B.prototype,O),I&&A(B,I),B}}(),R=_(0),T=_(13),z=function(A){return A&&A.__esModule?A:{default:A}}(T),N=function(A){function B(O){S(this,B);var I=E(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,O));return I.name='continuous',I.settings=(0,R.extend)(I.settings||{},{infinite:!0,overflow:'auto',axis:'vertical',offset:500,offsetDelta:250,width:void 0,height:void 0}),(0,R.extend)(I.settings,O.settings||{}),'undefined'!=O.settings.gap&&0===O.settings.gap&&(I.settings.gap=O.settings.gap),I.viewSettings={ignoreClass:I.settings.ignoreClass,axis:I.settings.axis,layout:I.layout,width:0,height:0},I.scrollTop=0,I.scrollLeft=0,I}return P(B,A),L(B,[{key:'display',value:function(I,M){return z.default.prototype.display.call(this,I,M).then(function(){return this.fill()}.bind(this))}},{key:'fill',value:function(I){var M=I||new R.defer;return this.check().then(function(U){U?this.fill(M):M.resolve()}.bind(this)),M.promise}},{key:'moveTo',value:function(I){var M=0,U=0,W=0,D=0;return'vertical'===this.settings.axis?(U=I.top,D=I.top+this.settings.offset):(M=Math.floor(I.left/this.layout.delta)*this.layout.delta,W=M+this.settings.offset),this.check(W,D).then(function(){this.scrollBy(M,U,!0)}.bind(this))}},{key:'resize',value:function(I,M){this.q.clear(),this._stageSize=this.stage.size(I,M),this._bounds=this.bounds(),console.log('set bounds',this._bounds),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.views.each(function(U){U.size(this._stageSize.width,this._stageSize.height)}.bind(this)),this.updateLayout(),this.emit('resized',{width:this.stage.width,height:this.stage.height})}},{key:'onResized',value:function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.resize()}.bind(this),150)}},{key:'afterResized',value:function(I){this.emit('resize',I.section)}},{key:'removeShownListeners',value:function(I){I.onDisplayed=function(){}}},{key:'append',value:function(I){var M=this.createView(I);return this.views.append(M),M.onDisplayed=this.afterDisplayed.bind(this),M}},{key:'prepend',value:function(I){var M=this.createView(I);return M.on('resized',this.counter.bind(this)),this.views.prepend(M),M.onDisplayed=this.afterDisplayed.bind(this),M}},{key:'counter',value:function(I){'vertical'===this.settings.axis?this.scrollBy(0,I.heightDelta,!0):this.scrollBy(I.widthDelta,0,!0)}},{key:'update',value:function(I){for(var M=this.bounds(),U=this.views.all(),W=U.length,D=[],F='undefined'==typeof I?this.settings.offset||0:I,X=new R.defer,Y=[],J=0,H,V;J<W;J++)V=U[J],H=this.isVisible(V,F,F,M),!0===H?(!V.displayed&&Y.push(V.display(this.request).then(function(Z){Z.show()})),D.push(V)):(this.q.enqueue(V.destroy.bind(V)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim.bind(this))}.bind(this),250));return Y.length?Promise.all(Y):(X.resolve(),X.promise)}},{key:'check',value:function(I,M){var H=new R.defer,V=[],X='horizontal'===this.settings.axis,Y=this.settings.offset||0,U,W,D,F;I&&X&&(Y=I),M&&!X&&(Y=M);var J=this._bounds,Z=X?this.scrollLeft:this.scrollTop,Q=X?J.width:J.height,K=X?this.container.scrollWidth:this.container.scrollHeight;return Z+Q+Y>=K&&(U=this.views.last(),D=U&&U.section.next(),D&&V.push(this.append(D))),0>Z-Y&&(W=this.views.first(),F=W&&W.section.prev(),F&&V.push(this.prepend(F))),V.length?this.q.enqueue(function(){return this.update(Y)}.bind(this)):(H.resolve(!1),H.promise)}},{key:'trim',value:function(){for(var I=new R.defer,M=this.views.displayed(),U=M[0],W=M[M.length-1],D=this.views.indexOf(U),F=this.views.indexOf(W),H=this.views.slice(0,D),V=this.views.slice(F+1),X=0;X<H.length-1;X++)this.erase(H[X],H);for(var Y=1;Y<V.length;Y++)this.erase(V[Y]);return I.resolve(),I.promise}},{key:'erase',value:function(I,M){var U,W;this.settings.height?(U=this.container.scrollTop,W=this.container.scrollLeft):(U=window.scrollY,W=window.scrollX);var D=I.bounds();this.views.remove(I),M&&('vertical'===this.settings.axis?this.scrollTo(0,U-D.height,!0):this.scrollTo(W-D.width,0,!0))}},{key:'addEventListeners',value:function(){window.addEventListener('unload',function(){this.ignore=!0,this.destroy()}.bind(this)),this.addScrollListeners()}},{key:'addScrollListeners',value:function(){var I;this.tick=R.requestAnimationFrame,this.settings.height?(this.prevScrollTop=this.container.scrollTop,this.prevScrollLeft=this.container.scrollLeft):(this.prevScrollTop=window.scrollY,this.prevScrollLeft=window.scrollX),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.height?(I=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft):(I=window,this.scrollTop=window.scrollY,this.scrollLeft=window.scrollX),I.addEventListener('scroll',this.onScroll.bind(this)),this.scrolled=!1}},{key:'removeEventListeners',value:function(){var I;I=this.settings.height?this.container:window,I.removeEventListener('scroll',this.onScroll.bind(this))}},{key:'onScroll',value:function(){var I,M;this.settings.height?(I=this.container.scrollTop,M=this.container.scrollLeft):(I=window.scrollY,M=window.scrollX),this.scrollTop=I,this.scrollLeft=M,this.ignore?this.ignore=!1:(0===this.scrollDeltaVert&&0===this.scrollDeltaHorz||this.scrollDeltaVert>this.settings.offsetDelta||this.scrollDeltaHorz>this.settings.offsetDelta)&&(this.q.enqueue(function(){this.check()}.bind(this)),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.emit('scroll',{top:I,left:M}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit('scrolled',{top:this.scrollTop,left:this.scrollLeft})}.bind(this))),this.scrollDeltaVert+=Math.abs(I-this.prevScrollTop),this.scrollDeltaHorz+=Math.abs(M-this.prevScrollLeft),this.prevScrollTop=I,this.prevScrollLeft=M,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),this.scrolled=!1}},{key:'updateLayout',value:function(){this.stage&&('vertical'===this.settings.axis?this.layout.calculate(this._stageSize.width,this._stageSize.height):(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta,this.stage.addStyleRules('iframe',[{"margin-right":this.layout.gap+'px'}])),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}},{key:'next',value:function(){'horizontal'===this.settings.axis?(this.scrollLeft=this.container.scrollLeft,this.container.scrollLeft+this.container.offsetWidth+this.layout.delta<this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this))}},{key:'prev',value:function(){'horizontal'===this.settings.axis?this.scrollBy(-this.layout.delta,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this))}},{key:'updateFlow',value:function(I){var M='paginated'===I?'horizontal':'vertical';this.settings.axis=M,this.viewSettings.axis=M,this.settings.overflow='paginated'===I?'hidden':'auto',this.settings.infinite='vertical'===this.settings.axis}}]),B}(z.default);k.default=N,v.exports=k['default']},function(v,k,_){'use strict';function C(O){return O&&O.__esModule?O:{default:O}}function S(O,I){if(!(O instanceof I))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function O(I,M){for(var U=0,W;U<M.length;U++)W=M[U],W.enumerable=W.enumerable||!1,W.configurable=!0,'value'in W&&(W.writable=!0),Object.defineProperty(I,W.key,W)}return function(I,M,U){return M&&O(I.prototype,M),U&&O(I,U),I}}(),P=_(2),L=C(P),R=_(0),T=_(1),z=C(T),N=_(7),A=C(N),B=function(){function O(I,M){S(this,O),this.settings=(0,R.extend)({ignoreClass:'',axis:'vertical',width:0,height:0,layout:void 0,globalLayoutProperties:{}},M||{}),this.id='epubjs-view-'+(0,R.uuid)(),this.section=I,this.index=I.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new z.default,this.layout=this.settings.layout}return E(O,[{key:'container',value:function(M){var U=document.createElement('div');return U.classList.add('epub-view'),U.style.height='0px',U.style.width='0px',U.style.overflow='hidden',U.style.display=M&&'horizontal'==M?'inline-block':'block',U}},{key:'create',value:function(){return this.iframe?this.iframe:(this.element||(this.element=this.createContainer()),this.iframe=document.createElement('iframe'),this.iframe.id=this.id,this.iframe.scrolling='no',this.iframe.style.overflow='hidden',this.iframe.seamless='seamless',this.iframe.style.border='none',this.resizing=!0,this.element.style.visibility='hidden',this.iframe.style.visibility='hidden',this.iframe.style.width='0',this.iframe.style.height='0',this._width=0,this._height=0,this.element.appendChild(this.iframe),this.added=!0,this.elementBounds=(0,R.bounds)(this.element),this.supportsSrcdoc=!!('srcdoc'in this.iframe),this.iframe)}},{key:'render',value:function(M){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(M)),this.sectionRender.then(function(W){return this.load(W)}.bind(this)).then(function(){}.bind(this)).then(function(){var W=this;return this.settings.layout.format(this.contents),this.addListeners(),new Promise(function(D){setTimeout(function(){W.expand(),D()},1)})}.bind(this)).then(function(){this.emit('rendered',this.section)}.bind(this)).catch(function(W){this.emit('loaderror',W)}.bind(this))}},{key:'size',value:function(M,U){var W=M||this.settings.width,D=U||this.settings.height;'pre-paginated'===this.layout.name?this.lock('both',W,D):'horizontal'===this.settings.axis?this.lock('height',W,D):this.lock('width',W,D)}},{key:'lock',value:function(M,U,W){var D=(0,R.borders)(this.element),F;F=this.iframe?(0,R.borders)(this.iframe):{width:0,height:0},'width'==M&&(0,R.isNumber)(U)&&(this.lockedWidth=U-D.width-F.width,this.resize(this.lockedWidth,U)),'height'==M&&(0,R.isNumber)(W)&&(this.lockedHeight=W-D.height-F.height,this.resize(U,this.lockedHeight)),'both'===M&&(0,R.isNumber)(U)&&(0,R.isNumber)(W)&&(this.lockedWidth=U-D.width-F.width,this.lockedHeight=W-D.height-F.height,this.resize(this.lockedWidth,this.lockedHeight)),this.displayed&&this.iframe&&this.expand()}},{key:'expand',value:function(){var U=this.lockedWidth,W=this.lockedHeight,D,F,H;!this.iframe||this._expanding||'pre-paginated'===this.layout.name||(this._expanding=!0,'horizontal'===this.settings.axis?(F=this.contents.textWidth(),U=this.contentWidth(F),U==this._width?U=this._contentWidth:(D=Math.ceil(U/(this.settings.layout.columnWidth+this.settings.layout.gap)),1<this.settings.layout.divisor&&'reflowable'===this.settings.layout.name&&0<D%2&&(U+=this.settings.layout.gap+this.settings.layout.columnWidth),this._textWidth=F,this._contentWidth=U)):'vertical'===this.settings.axis&&(H=this.contents.textHeight(),H==this._textHeight?W=this._contentHeight:(W=this.contentHeight(H),this._textHeight=H,this._contentHeight=W)),(this._needsReframe||U!=this._width||W!=this._height)&&this.resize(U,W),this._expanding=!1)}},{key:'contentWidth',value:function(M){var U,W;return U=this.iframe.style.width,this.iframe.style.width=(M||0)+'px',W=this.contents.scrollWidth(),this.iframe.style.width=U,W}},{key:'contentHeight',value:function(M){var U,W;return U=this.iframe.style.height,this.iframe.style.height=(M||0)+'px',W=this.contents.scrollHeight(),this.iframe.style.height=U,W}},{key:'resize',value:function(M,U){this.iframe&&((0,R.isNumber)(M)&&(this.iframe.style.width=M+'px',this._width=M),(0,R.isNumber)(U)&&(this.iframe.style.height=U+'px',this._height=U),this.iframeBounds=(0,R.bounds)(this.iframe),this.reframe(this.iframeBounds.width,this.iframeBounds.height))}},{key:'reframe',value:function(M,U){var W;(0,R.isNumber)(M)&&(this.element.style.width=M+'px'),(0,R.isNumber)(U)&&(this.element.style.height=U+'px'),this.prevBounds=this.elementBounds,this.elementBounds=(0,R.bounds)(this.element),W={width:this.elementBounds.width,height:this.elementBounds.height,widthDelta:this.elementBounds.width-this.prevBounds.width,heightDelta:this.elementBounds.height-this.prevBounds.height},this.onResize(this,W),this.contents&&this.settings.layout.format(this.contents),this.emit('resized',W)}},{key:'load',value:function(M){var U=new R.defer,W=U.promise;if(!this.iframe)return U.reject(new Error('No Iframe Available')),W;if(this.iframe.onload=function(D){this.onLoad(D,U)}.bind(this),this.supportsSrcdoc)this.iframe.srcdoc=M;else{if(this.document=this.iframe.contentDocument,!this.document)return U.reject(new Error('No Document Available')),W;this.iframe.contentDocument.open(),this.iframe.contentDocument.write(M),this.iframe.contentDocument.close()}return W}},{key:'onLoad',value:function(M,U){var W=this;this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new A.default(this.document,this.document.body,this.section.cfiBase,this.section.index),this.rendering=!1;var D=this.document.querySelector('link[rel=\'canonical\']');D?D.setAttribute('href',this.section.url):(D=this.document.createElement('link'),D.setAttribute('rel','canonical'),D.setAttribute('href',this.section.url),this.document.querySelector('head').appendChild(D)),this.contents.on('expand',function(){W.displayed&&W.iframe&&W.expand()}),this.contents.on('resize',function(){W.displayed&&W.iframe&&W.expand()}),U.resolve(this.contents)}},{key:'setLayout',value:function(M){this.layout=M}},{key:'setAxis',value:function(M){this.settings.axis=M}},{key:'resizeListenters',value:function(){clearTimeout(this.expanding),this.expanding=setTimeout(this.expand.bind(this),350)}},{key:'addListeners',value:function(){}},{key:'removeListeners',value:function(){}},{key:'display',value:function(M){var U=new R.defer;return this.displayed?U.resolve(this):this.render(M).then(function(){this.emit('displayed',this),this.onDisplayed(this),this.displayed=!0,U.resolve(this)}.bind(this)),U.promise}},{key:'show',value:function(){this.element.style.visibility='visible',this.iframe&&(this.iframe.style.visibility='visible'),this.emit('shown',this)}},{key:'hide',value:function(){this.element.style.visibility='hidden',this.iframe.style.visibility='hidden',this.stopExpanding=!0,this.emit('hidden',this)}},{key:'offset',value:function(){return{top:this.element.offsetTop,left:this.element.offsetLeft}}},{key:'width',value:function(){return this._width}},{key:'height',value:function(){return this._height}},{key:'position',value:function(){return this.element.getBoundingClientRect()}},{key:'locationOf',value:function(M){var U=this.iframe.getBoundingClientRect(),W=this.contents.locationOf(M,this.settings.ignoreClass);return{left:W.left,top:W.top}}},{key:'onDisplayed',value:function(){}},{key:'onResize',value:function(){}},{key:'bounds',value:function(){return this.elementBounds||(this.elementBounds=(0,R.bounds)(this.element)),this.elementBounds}},{key:'destroy',value:function(){this.displayed&&(this.displayed=!1,this.removeListeners(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.displayed=!1,this.iframe=null,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}]),O}();(0,L.default)(B.prototype),k.default=B,v.exports=k['default']},function(v,k){'use strict';function C(P,L){function R(A){for(var B=L.length-1,O;0<=B;B--)if(O=L[B],!!E(O,A.clientX,A.clientY)){O.dispatchEvent(S(A));break}}for(var T=['mouseup','mousedown','click'],z=0,N;z<T.length;z++)N=T[z],P.addEventListener(N,function(A){return R(A)},!1)}function S(P){var L=Object.assign({},P,{bubbles:!1});try{return new MouseEvent(P.type,L)}catch(T){var R=document.createEvent('MouseEvents');return R.initMouseEvent(P.type,!1,L.cancelable,L.view,L.detail,L.screenX,L.screenY,L.clientX,L.clientY,L.ctrlKey,L.altKey,L.shiftKey,L.metaKey,L.button,L.relatedTarget),R}}function E(P,L,R){function T(O,I,M){var U=O.top+O.height,W=O.left+O.width;return O.top<=M&&O.left<=I&&U>M&&W>I}var z=P.getBoundingClientRect();if(!T(z,L,R))return!1;for(var N=P.getClientRects(),A=0,B=N.length;A<B;A++)if(T(N[A],L,R))return!0;return!1}Object.defineProperty(k,'__esModule',{value:!0}),k.proxyMouse=C,k.clone=S,k.default={proxyMouse:C}},function(v,k,_){'use strict';function C(F){return F&&F.__esModule?F:{default:F}}function S(F,H){if(!F)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return H&&('object'==typeof H||'function'==typeof H)?H:F}function E(F,H){if('function'!=typeof H&&null!==H)throw new TypeError('Super expression must either be null or a function, not '+typeof H);F.prototype=Object.create(H&&H.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),H&&(Object.setPrototypeOf?Object.setPrototypeOf(F,H):F.__proto__=H)}function P(F,H){if(!(F instanceof H))throw new TypeError('Cannot call a class as a function')}function L(F){var H=F.getBoundingClientRect();return{top:H.top+F.ownerDocument.body.scrollTop,left:H.left+F.ownerDocument.body.scrollLeft,height:F.scrollHeight}}function R(F,H){F.style.top=H.top+'px',F.style.left=H.left+'px',F.style.height=H.height+'px',F.style.width=H.width+'px'}function T(F,H){return H.right<=F.right&&H.left>=F.left&&H.top>=F.top&&H.bottom<=F.bottom}Object.defineProperty(k,'__esModule',{value:!0}),k.Underline=k.Highlight=k.Mark=k.Pane=void 0;var z=function F(H,V,X){null===H&&(H=Function.prototype);var Y=Object.getOwnPropertyDescriptor(H,V);if(Y===void 0){var J=Object.getPrototypeOf(H);return null===J?void 0:F(J,V,X)}if('value'in Y)return Y.value;var Z=Y.get;return void 0===Z?void 0:Z.call(X)},N=function(){function F(H,V){for(var X=0,Y;X<V.length;X++)Y=V[X],Y.enumerable=Y.enumerable||!1,Y.configurable=!0,'value'in Y&&(Y.writable=!0),Object.defineProperty(H,Y.key,Y)}return function(H,V,X){return V&&F(H.prototype,V),X&&F(H,X),H}}(),A=_(24),B=C(A),O=_(22),I=C(O),M=k.Pane=function(){function F(H){var V=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.body;P(this,F),this.target=H,this.element=B.default.createElement('svg'),this.marks=[],this.element.style.position='absolute',this.element.setAttribute('pointer-events','none'),I.default.proxyMouse(this.target,this.marks),V.appendChild(this.element),this.render()}return N(F,[{key:'addMark',value:function(V){var X=B.default.createElement('g');return this.element.appendChild(X),V.bind(X),this.marks.push(V),V.render(),V}},{key:'removeMark',value:function(V){var X=this.marks.indexOf(V);if(-1!==X){var Y=V.unbind();this.element.removeChild(Y),this.marks.splice(X,1)}}},{key:'render',value:function(){R(this.element,L(this.target));var V=!0,X=!1,Y;try{for(var J=this.marks[Symbol.iterator](),Z,Q;!(V=(Z=J.next()).done);V=!0)Q=Z.value,Q.render()}catch(K){X=!0,Y=K}finally{try{!V&&J.return&&J.return()}finally{if(X)throw Y}}}}]),F}(),U=k.Mark=function(){function F(){P(this,F),this.element=null}return N(F,[{key:'bind',value:function(V){this.element=V}},{key:'unbind',value:function(){var V=this.element;return this.element=null,V}},{key:'render',value:function(){}},{key:'dispatchEvent',value:function(V){this.element&&this.element.dispatchEvent(V)}},{key:'getBoundingClientRect',value:function(){return this.element.getBoundingClientRect()}},{key:'getClientRects',value:function(){for(var V=[],X=this.element.firstChild;X;)V.push(X.getBoundingClientRect()),X=X.nextSibling;return V}},{key:'filteredRanges',value:function(){var V=Array.from(this.range.getClientRects());return V.filter(function(X){for(var Y=0;Y<V.length;Y++){if(V[Y]===X)return!0;var J=T(V[Y],X);if(J)return!1}return!0})}}]),F}(),W=k.Highlight=function(F){function H(V,X,Y,J){P(this,H);var Z=S(this,(H.__proto__||Object.getPrototypeOf(H)).call(this));return Z.range=V,Z.className=X,Z.data=Y||{},Z.attributes=J||{},Z}return E(H,F),N(H,[{key:'bind',value:function(X){for(var Y in z(H.prototype.__proto__||Object.getPrototypeOf(H.prototype),'bind',this).call(this,X),this.data)this.data.hasOwnProperty(Y)&&(this.element.dataset[Y]=this.data[Y]);for(var Y in this.attributes)this.attributes.hasOwnProperty(Y)&&this.element.setAttribute(Y,this.attributes[Y]);this.className&&this.element.classList.add(this.className)}},{key:'render',value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var X=this.element.ownerDocument.createDocumentFragment(),Y=this.filteredRanges(),J=this.element.getBoundingClientRect(),Z=0,Q=Y.length;Z<Q;Z++){var K=Y[Z],G=B.default.createElement('rect');G.setAttribute('x',K.left-J.left),G.setAttribute('y',K.top-J.top),G.setAttribute('height',K.height),G.setAttribute('width',K.width),X.appendChild(G)}this.element.appendChild(X)}}]),H}(U),D=k.Underline=function(F){function H(V,X,Y,J){return P(this,H),S(this,(H.__proto__||Object.getPrototypeOf(H)).call(this,V,X,Y,J))}return E(H,F),N(H,[{key:'render',value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var X=this.element.ownerDocument.createDocumentFragment(),Y=this.filteredRanges(),J=this.element.getBoundingClientRect(),Z=0,Q=Y.length;Z<Q;Z++){var K=Y[Z],G=B.default.createElement('rect');G.setAttribute('x',K.left-J.left),G.setAttribute('y',K.top-J.top),G.setAttribute('height',K.height),G.setAttribute('width',K.width),G.setAttribute('fill','none');var $=B.default.createElement('line');$.setAttribute('x1',K.left-J.left),$.setAttribute('x2',K.left-J.left+K.width),$.setAttribute('y1',K.top-J.top+K.height-1),$.setAttribute('y2',K.top-J.top+K.height-1),$.setAttribute('stroke-width',1),$.setAttribute('stroke','black'),$.setAttribute('stroke-linecap','square'),X.appendChild(G),X.appendChild($)}this.element.appendChild(X)}}]),H}(W)},function(v,k){'use strict';function C(S){return document.createElementNS('http://www.w3.org/2000/svg',S)}Object.defineProperty(k,'__esModule',{value:!0}),k.createElement=C,k.default={createElement:C}},function(v,k,_){'use strict';function C(A){return A&&A.__esModule?A:{default:A}}function S(A,B){if(!(A instanceof B))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function A(B,O){for(var I=0,M;I<O.length;I++)M=O[I],M.enumerable=M.enumerable||!1,M.configurable=!0,'value'in M&&(M.writable=!0),Object.defineProperty(B,M.key,M)}return function(B,O,I){return O&&A(B.prototype,O),I&&A(B,I),B}}(),P=_(2),L=C(P),R=_(1),T=C(R),z=function(){function A(B){S(this,A),this.rendition=B,this.highlights=[],this.underlines=[],this.marks=[],this._annotations={},this._annotationsBySectionIndex={},this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.clear.bind(this))}return E(A,[{key:'add',value:function(O,I,M,U){var W=encodeURI(I),D=new T.default(I),F=D.spinePos,H=new N({type:O,cfiRange:I,data:M,sectionIndex:F,cb:U});this._annotations[W]=H,F in this._annotationsBySectionIndex?this._annotationsBySectionIndex[F].push(W):this._annotationsBySectionIndex[F]=[W];var V=this.rendition.getContents();return V.forEach(function(X){H.sectionIndex===X.sectionIndex&&H.attach(X)}),H}},{key:'remove',value:function(O){var I=decodeURI(O),M;if(I in this._annotations){var U=this._annotations[I],W=this.rendition.getContents();W.forEach(function(D){U.sectionIndex===D.sectionIndex&&U.detach(D)}),delete this._annotations[I]}return M}},{key:'highlight',value:function(O,I,M){this.add('highlight',O,I,M)}},{key:'underline',value:function(O,I,M){this.add('underline',O,I,M)}},{key:'mark',value:function(O,I,M){this.add('mark',O,I,M)}},{key:'each',value:function(){return this._annotations.forEach.apply(this._annotations,arguments)}},{key:'inject',value:function(O){var I=this,M=O.index;if(M in this._annotationsBySectionIndex){var U=this._annotationsBySectionIndex[M];U.forEach(function(W){var D=I._annotations[W];D.attach(O)})}}},{key:'clear',value:function(O){var I=this,M=O.index;if(M in this._annotationsBySectionIndex){var U=this._annotationsBySectionIndex[M];U.forEach(function(W){var D=I._annotations[W];D.detach(O)})}}},{key:'show',value:function(){}},{key:'hide',value:function(){}}]),A}(),N=function(){function A(B){var O=B.type,I=B.cfiRange,M=B.data,U=B.sectionIndex;S(this,A),this.type=O,this.cfiRange=I,this.data=M,this.sectionIndex=U,this.mark=void 0}return E(A,[{key:'update',value:function(O){this.data=O}},{key:'attach',value:function(O){var I=this.cfiRange,M=this.data,U=this.type,W=this.mark,D=this.cb,F;return'highlight'===U?F=O.highlight(I,M,D):'underline'===U?F=O.underline(I,M,D):'mark'===U&&(F=O.mark(I,M,D)),this.mark=F,F}},{key:'detach',value:function(O){var I=this.cfiRange,M=this.type;return O&&('highlight'===M?result=O.unhighlight(I):'underline'===M?result=O.ununderline(I):'mark'===M&&(result=O.unmark(I))),this.mark=void 0,result}},{key:'text',value:function(){}}]),A}();(0,L.default)(N.prototype),k.default=z,v.exports=k['default']},function(v,k,_){'use strict';function C(O){return O&&O.__esModule?O:{default:O}}function S(O,I){if(!(O instanceof I))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function O(I,M){for(var U=0,W;U<M.length;U++)W=M[U],W.enumerable=W.enumerable||!1,W.configurable=!0,'value'in W&&(W.writable=!0),Object.defineProperty(I,W.key,W)}return function(I,M,U){return M&&O(I.prototype,M),U&&O(I,U),I}}(),P=_(0),L=_(11),R=C(L),T=_(16),z=C(T),N=_(3),A=C(N),B=function(){function O(){S(this,O),this.zip=void 0,this.urlCache={},this.checkRequirements()}return E(O,[{key:'checkRequirements',value:function(){try{if('undefined'==typeof JSZip){var M=_(56);this.zip=new M}else this.zip=new JSZip}catch(U){throw new Error('JSZip lib not loaded')}}},{key:'open',value:function(M,U){return this.zip.loadAsync(M,{base64:U})}},{key:'openUrl',value:function(M,U){return(0,R.default)(M,'binary').then(function(W){return this.zip.loadAsync(W,{base64:U})}.bind(this))}},{key:'request',value:function(M,U){var W=new P.defer,F=new A.default(M),D;return U||(U=F.extension),D='blob'==U?this.getBlob(M):this.getText(M),D?D.then(function(H){var V=this.handleResponse(H,U);W.resolve(V)}.bind(this)):W.reject({message:'File not found in the epub: '+M,stack:new Error().stack}),W.promise}},{key:'handleResponse',value:function(M,U){var W;return W='json'==U?JSON.parse(M):(0,P.isXml)(U)?(0,P.parse)(M,'text/xml'):'xhtml'==U?(0,P.parse)(M,'application/xhtml+xml'):'html'==U||'htm'==U?(0,P.parse)(M,'text/html'):M,W}},{key:'getBlob',value:function(M,U){var W=window.decodeURIComponent(M.substr(1)),D=this.zip.file(W);if(D)return U=U||z.default.lookup(D.name),D.async('uint8array').then(function(F){return new Blob([F],{type:U})})}},{key:'getText',value:function(M){var W=window.decodeURIComponent(M.substr(1)),D=this.zip.file(W);if(D)return D.async('string').then(function(F){return F})}},{key:'getBase64',value:function(M,U){var W=window.decodeURIComponent(M.substr(1)),D=this.zip.file(W);if(D)return U=U||z.default.lookup(D.name),D.async('base64').then(function(F){return'data:'+U+';base64,'+F})}},{key:'createUrl',value:function(M,U){var W=new P.defer,D=window.URL||window.webkitURL||window.mozURL,V=U&&U.base64,F,H;return M in this.urlCache?(W.resolve(this.urlCache[M]),W.promise):(V?(H=this.getBase64(M),H&&H.then(function(X){this.urlCache[M]=X,W.resolve(X)}.bind(this))):(H=this.getBlob(M),H&&H.then(function(X){F=D.createObjectURL(X),this.urlCache[M]=F,W.resolve(F)}.bind(this))),H||W.reject({message:'File not found in the epub: '+M,stack:new Error().stack}),W.promise)}},{key:'revokeUrl',value:function(M){var U=window.URL||window.webkitURL||window.mozURL,W=this.urlCache[M];W&&U.revokeObjectURL(W)}},{key:'destroy',value:function(){var M=window.URL||window.webkitURL||window.mozURL;for(var U in this.urlCache)M.revokeObjectURL(U);this.zip=void 0,this.urlCache={}}}]),O}();k.default=B,v.exports=k['default']},function(v,k,_){'use strict';function S(z,N){if(!(z instanceof N))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function z(N,A){for(var B=0,O;B<A.length;B++)O=A[B],O.enumerable=O.enumerable||!1,O.configurable=!0,'value'in O&&(O.writable=!0),Object.defineProperty(N,O.key,O)}return function(N,A,B){return A&&z(N.prototype,A),B&&z(N,B),N}}(),P=_(6),L=function(z){return z&&z.__esModule?z:{default:z}}(P),R=_(0),T=function(){function z(N){S(this,z),this.packagePath='',this.directory='',this.encoding='',N&&this.parse(N)}return E(z,[{key:'parse',value:function(A){var B;if(!A)throw new Error('Container File Not Found');if(B=(0,R.qs)(A,'rootfile'),!B)throw new Error('No RootFile Found');this.packagePath=B.getAttribute('full-path'),this.directory=L.default.dirname(this.packagePath),this.encoding=A.xmlEncoding}},{key:'destroy',value:function(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}}]),z}();k.default=T,v.exports=k['default']},function(v,k,_){'use strict';(function(C){function E(U){return U&&U.__esModule?U:{default:U}}function P(U,W){return new R.default(U,W)}Object.defineProperty(k,'__esModule',{value:!0});var L=_(19),R=E(L),T=_(1),z=E(T),N=_(14),A=E(N),B=_(7),O=E(B),I=_(0),M=function(U){if(U&&U.__esModule)return U;var W={};if(null!=U)for(var D in U)Object.prototype.hasOwnProperty.call(U,D)&&(W[D]=U[D]);return W.default=U,W}(I);_(18),P.VERSION='0.3','undefined'!=typeof C&&(C.EPUBJS_VERSION=P.VERSION),P.CFI=z.default,P.Rendition=A.default,P.Contents=O.default,P.utils=M,P.ViewManagers={},P.Views={},P.register={manager:function(W,D){return P.ViewManagers[W]=D},view:function(W,D){return P.Views[W]=D}},P.register.view('iframe',_(21)),P.register.manager('default',_(13)),P.register.manager('continuous',_(20)),k.default=P,v.exports=k['default']}).call(k,_(15))},function(v,k){'use strict';function C(P,L){if(!(P instanceof L))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function P(L,R){for(var T=0,z;T<R.length;T++)z=R[T],z.enumerable=z.enumerable||!1,z.configurable=!0,'value'in z&&(z.writable=!0),Object.defineProperty(L,z.key,z)}return function(L,R,T){return R&&P(L.prototype,R),T&&P(L,T),L}}(),E=function(){function P(L){C(this,P),this.settings=L,this.name=L.layout||'reflowable',this._spread='none'!==L.spread,this._minSpreadWidth=L.minSpreadWidth||800,this._evenSpreads=L.evenSpreads||!1,this._flow='scrolled'===L.flow||'scrolled-continuous'===L.flow||'scrolled-doc'===L.flow?'scrolled':'paginated',this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}return S(P,[{key:'flow',value:function(R){return'undefined'!=typeof R&&(this._flow='scrolled'===R||'scrolled-continuous'===R||'scrolled-doc'===R?'scrolled':'paginated',this.props.flow=this._flow),this._flow}},{key:'spread',value:function(R,T){return R&&(this._spread='none'!==R,this.props.spread=this._spread),0<=T&&(this._minSpreadWidth=T),this._spread}},{key:'calculate',value:function(R,T,z){var N=1,A=z||0,B=R,O=Math.floor(B/8),I,M,U;N=this._spread&&B>=this._minSpreadWidth?2:1,'reflowable'!==this.name||'paginated'!==this._flow||0<=z||(A=0==O%2?O:O-1),'pre-paginated'===this.name&&(A=0),I=1<N?(B-A)/N:B,'pre-paginated'===this.name&&1<N&&(B=I),M=I*N,U=(I+A)*N,this.width=B,this.height=T,this.spreadWidth=M,this.delta=U,this.columnWidth=I,this.gap=A,this.divisor=N,this.props.width=B,this.props.height=T,this.props.spreadWidth=M,this.props.delta=U,this.props.columnWidth=I,this.props.gap=A,this.props.divisor=N}},{key:'format',value:function(R){var T;return T='pre-paginated'===this.name?R.fit(this.columnWidth,this.height):'paginated'===this._flow?R.columns(this.width,this.height,this.columnWidth,this.gap):R.size(this.width,null),T}},{key:'count',value:function(R,T){var z,N;return'pre-paginated'===this.name?(z=1,N=1):'paginated'===this._flow?(T=T||this.delta,z=Math.ceil(R/T),N=z*this.divisor):(T=T||this.height,z=Math.ceil(R/T),N=z),{spreads:z,pages:N}}}]),P}();k.default=E,v.exports=k['default']},function(v,k,_){'use strict';function C(O){return O&&O.__esModule?O:{default:O}}function S(O,I){if(!(O instanceof I))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function O(I,M){for(var U=0,W;U<M.length;U++)W=M[U],W.enumerable=W.enumerable||!1,W.configurable=!0,'value'in W&&(W.writable=!0),Object.defineProperty(I,W.key,W)}return function(I,M,U){return M&&O(I.prototype,M),U&&O(I,U),I}}(),P=_(0),L=_(10),R=C(L),T=_(1),z=C(T),N=_(2),A=C(N),B=function(){function O(I,M,U){S(this,O),this.spine=I,this.request=M,this.pause=U||100,this.q=new R.default(this),this.epubcfi=new z.default,this._locations=[],this.total=0,this.break=150,this._current=0,this.currentLocation='',this._currentCfi='',this.processingTimeout=void 0}return E(O,[{key:'generate',value:function(M){return M&&(this.break=M),this.q.pause(),this.spine.each(function(U){U.linear&&this.q.enqueue(this.process.bind(this),U)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))}},{key:'createRange',value:function(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}},{key:'process',value:function(M){return M.load(this.request).then(function(U){var W=new P.defer,D=this.parse(U,M.cfiBase);return this._locations=this._locations.concat(D),M.unload(),this.processingTimeout=setTimeout(function(){return W.resolve(D)},this.pause),W.promise}.bind(this))}},{key:'parse',value:function(M,U,W){var D=[],H=M.ownerDocument,V=(0,P.qs)(H,'body'),X=0,J=W||this.break,F,Y;if((0,P.sprint)(V,function(G){var $=G.length,te=0,ee;if(0===G.textContent.trim().length)return!1;for(0==X&&(F=this.createRange(),F.startContainer=G,F.startOffset=0),ee=J-X,ee>$&&(X+=$,te=$);te<$;)if(ee=J-X,0===X&&(te+=1,F=this.createRange(),F.startContainer=G,F.startOffset=te),te+ee>=$)X+=$-te,te=$;else{te+=ee,F.endContainer=G,F.endOffset=te;var ne=new z.default(F,U).toString();D.push(ne),X=0}Y=G}.bind(this)),F&&F.startContainer&&Y){F.endContainer=Y,F.endOffset=Y.length;var Q=new z.default(F,U).toString();D.push(Q),X=0}return D}},{key:'locationFromCfi',value:function(M){var U;return(z.default.prototype.isCfiString(M)&&(M=new z.default(M)),0===this._locations.length)?-1:(U=(0,P.locationOf)(M,this._locations,this.epubcfi.compare),U>this.total?this.total:U)}},{key:'percentageFromCfi',value:function(M){if(0===this._locations.length)return null;var U=this.locationFromCfi(M);return this.percentageFromLocation(U)}},{key:'percentageFromLocation',value:function(M){return M&&this.total?M/this.total:0}},{key:'cfiFromLocation',value:function(M){var U=-1;return'number'!=typeof M&&(M=parseInt(M)),0<=M&&M<this._locations.length&&(U=this._locations[M]),U}},{key:'cfiFromPercentage',value:function(M){var U;if(1<M&&console.warn('Normalize cfiFromPercentage value to between 0 - 1'),1<=M){var W=new z.default(this._locations[this.total]);return W.collapse(),W.toString()}return U=Math.ceil(this.total*M),this.cfiFromLocation(U)}},{key:'load',value:function(M){return this._locations=JSON.parse(M),this.total=this._locations.length-1,this._locations}},{key:'save',value:function(){return JSON.stringify(this._locations)}},{key:'getCurrent',value:function(){return this._current}},{key:'setCurrent',value:function(M){var U;if('string'==typeof M)this._currentCfi=M;else if('number'==typeof M)this._current=M;else return;0===this._locations.length||('string'==typeof M?(U=this.locationFromCfi(M),this._current=U):U=M,this.emit('changed',{percentage:this.percentageFromLocation(U)}))}},{key:'length',value:function(){return this._locations.length}},{key:'destroy',value:function(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.clear(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}},{key:'currentLocation',get:function(){return this._current},set:function(M){this.setCurrent(M)}}]),O}();(0,A.default)(B.prototype),k.default=B,v.exports=k['default']},function(v,k,_){'use strict';function C(L,R){if(!(L instanceof R))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function L(R,T){for(var z=0,N;z<T.length;z++)N=T[z],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(R,N.key,N)}return function(R,T,z){return T&&L(R.prototype,T),z&&L(R,z),R}}(),E=_(0),P=function(){function L(R){C(this,L),this.settings=R||{},this.id='epubjs-container-'+(0,E.uuid)(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}return S(L,[{key:'create',value:function(T){var z=T.height,N=T.width,A=T.overflow||!1,B=T.axis||'vertical';T.height&&(0,E.isNumber)(T.height)&&(z=T.height+'px'),T.width&&(0,E.isNumber)(T.width)&&(N=T.width+'px');var O=document.createElement('div');return O.id=this.id,O.classList.add('epub-container'),O.style.wordSpacing='0',O.style.lineHeight='0',O.style.verticalAlign='top',O.style.position='relative','horizontal'===B&&(O.style.whiteSpace='nowrap'),N&&(O.style.width=N),z&&(O.style.height=z),A&&(O.style.overflow=A),O}},{key:'wrap',value:function(T){var z=document.createElement('div');return z.style.visibility='hidden',z.style.overflow='hidden',z.style.width='0',z.style.height='0',z.appendChild(T),z}},{key:'getElement',value:function(T){var z;if((0,E.isElement)(T)?z=T:'string'==typeof T&&(z=document.getElementById(T)),!z)throw new Error('Not an Element');return z}},{key:'attachTo',value:function(T){var z=this.getElement(T),N;if(z)return N=this.settings.hidden?this.wrapper:this.container,z.appendChild(N),this.element=z,z}},{key:'getContainer',value:function(){return this.container}},{key:'onResize',value:function(T){(0,E.isNumber)(this.settings.width)&&(0,E.isNumber)(this.settings.height)||window.addEventListener('resize',T,!1)}},{key:'size',value:function(T,z){var N;return null===T&&(N=this.element.getBoundingClientRect(),N.width&&(T=N.width,this.container.style.width=N.width+'px')),null===z&&(N=N||this.element.getBoundingClientRect(),N.height&&(z=N.height,this.container.style.height=N.height+'px')),(0,E.isNumber)(T)||(N=this.container.getBoundingClientRect(),T=N.width),(0,E.isNumber)(z)||(N=N||this.container.getBoundingClientRect(),z=N.height),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles['padding-left'])||0,right:parseFloat(this.containerStyles['padding-right'])||0,top:parseFloat(this.containerStyles['padding-top'])||0,bottom:parseFloat(this.containerStyles['padding-bottom'])||0},{width:T-this.containerPadding.left-this.containerPadding.right,height:z-this.containerPadding.top-this.containerPadding.bottom}}},{key:'bounds',value:function(){var T=this.container&&this.container.getBoundingClientRect();return T&&T.width&&T.height?T:(0,E.windowBounds)()}},{key:'getSheet',value:function(){var T=document.createElement('style');return T.appendChild(document.createTextNode('')),document.head.appendChild(T),T.sheet}},{key:'addStyleRules',value:function(T,z){var N='#'+this.id+' ',A='';this.sheet||(this.sheet=this.getSheet()),z.forEach(function(B){for(var O in B)B.hasOwnProperty(O)&&(A+=O+':'+B[O]+';')}),this.sheet.insertRule(N+T+' {'+A+'}',0)}},{key:'destroy',value:function(){var T;this.element&&(T=this.settings.hidden?this.wrapper:this.container,this.element.contains(this.container)&&this.element.removeChild(this.container))}}]),L}();k.default=P,v.exports=k['default']},function(v,k){'use strict';function C(P,L){if(!(P instanceof L))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function P(L,R){for(var T=0,z;T<R.length;T++)z=R[T],z.enumerable=z.enumerable||!1,z.configurable=!0,'value'in z&&(z.writable=!0),Object.defineProperty(L,z.key,z)}return function(L,R,T){return R&&P(L.prototype,R),T&&P(L,T),L}}(),E=function(){function P(L){C(this,P),this.container=L,this._views=[],this.length=0,this.hidden=!1}return S(P,[{key:'all',value:function(){return this._views}},{key:'first',value:function(){return this._views[0]}},{key:'last',value:function(){return this._views[this._views.length-1]}},{key:'indexOf',value:function(R){return this._views.indexOf(R)}},{key:'slice',value:function(){return this._views.slice.apply(this._views,arguments)}},{key:'get',value:function(R){return this._views[R]}},{key:'append',value:function(R){return this._views.push(R),this.container&&this.container.appendChild(R.element),this.length++,R}},{key:'prepend',value:function(R){return this._views.unshift(R),this.container&&this.container.insertBefore(R.element,this.container.firstChild),this.length++,R}},{key:'insert',value:function(R,T){return this._views.splice(T,0,R),this.container&&(T<this.container.children.length?this.container.insertBefore(R.element,this.container.children[T]):this.container.appendChild(R.element)),this.length++,R}},{key:'remove',value:function(R){var T=this._views.indexOf(R);-1<T&&this._views.splice(T,1),this.destroy(R),this.length--}},{key:'destroy',value:function(R){R.displayed&&R.destroy(),this.container&&this.container.removeChild(R.element),R=null}},{key:'each',value:function(){return this._views.forEach.apply(this._views,arguments)}},{key:'clear',value:function(){var T=this.length,R;if(this.length){for(var z=0;z<T;z++)R=this._views[z],this.destroy(R);this._views=[],this.length=0}}},{key:'find',value:function(R){for(var z=this.length,N=0,T;N<z;N++)if(T=this._views[N],T.displayed&&T.section.index==R.index)return T}},{key:'displayed',value:function(){for(var L=[],T=this.length,z=0,R;z<T;z++)R=this._views[z],R.displayed&&L.push(R);return L}},{key:'show',value:function(){for(var T=this.length,z=0,R;z<T;z++)R=this._views[z],R.displayed&&R.show();this.hidden=!1}},{key:'hide',value:function(){for(var T=this.length,z=0,R;z<T;z++)R=this._views[z],R.displayed&&R.hide();this.hidden=!0}}]),P}();k.default=E,v.exports=k['default']},function(v,k,_){'use strict';function C(L,R){if(!(L instanceof R))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function L(R,T){for(var z=0,N;z<T.length;z++)N=T[z],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(R,N.key,N)}return function(R,T,z){return T&&L(R.prototype,T),z&&L(R,z),R}}(),E=_(0),P=function(){function L(R){C(this,L),this.toc=[],this.tocByHref={},this.tocById={},R&&this.parse(R)}return S(L,[{key:'parse',value:function(T){var z=T.nodeType,N,A;z&&(N=(0,E.qs)(T,'html'),A=(0,E.qs)(T,'ncx')),z?N?this.toc=this.parseNav(T):A&&(this.toc=this.parseNcx(T)):this.toc=this.load(T),this.unpack(this.toc)}},{key:'unpack',value:function(T){for(var N=0,z;N<T.length;N++)z=T[N],this.tocByHref[z.href]=N,this.tocById[z.id]=N}},{key:'get',value:function(T){var z;return T?(0===T.indexOf('#')?z=this.tocById[T.substring(1)]:T in this.tocByHref&&(z=this.tocByHref[T]),this.toc[z]):this.toc}},{key:'createTocItem',value:function(T,z){var N=this,A=[],B=T.childNodes,O=Array.prototype.slice.call(B),I=z?z:0;return O.forEach(function(M){if('li'===M.nodeName){var U=(0,E.qs)(M,'a'),W={id:-1,href:U.getAttribute('href'),label:U.textContent,parent:null},D=(0,E.qs)(M,'ol');if(I++,W.id=I,z&&(W.parent=z),A.push(W),D){var F=N.createTocItem(D,I);F&&0<F.length&&(I+=F.length,A=A.concat(F))}}}),A}},{key:'parseNav',value:function(T){var z=(0,E.querySelectorByType)(T,'nav','toc'),N=(0,E.qs)(z,'ol');return this.createTocItem(N)}},{key:'navItem',value:function(T){var z=T.getAttribute('id')||!1,N=(0,E.qs)(T,'a'),A=N.getAttribute('href')||'',B=N.textContent||'',I=T.parentNode,M;return I&&'navPoint'===I.nodeName&&(M=I.getAttribute('id')),{id:z,href:A,label:B,subitems:[],parent:M}}},{key:'parseNcx',value:function(T){var z=(0,E.qsa)(T,'navPoint'),N=z.length,B={},O=[],A,I,M;if(!z||0===N)return O;for(A=0;A<N;++A)I=this.ncxItem(z[A]),B[I.id]=I,I.parent?(M=B[I.parent],M.subitems.push(I)):O.push(I);return O}},{key:'ncxItem',value:function(T){var z=T.getAttribute('id')||!1,N=(0,E.qs)(T,'content'),A=N.getAttribute('src'),B=(0,E.qs)(T,'navLabel'),O=B.textContent?B.textContent:'',M=T.parentNode,U;return M&&'navPoint'===M.nodeName&&(U=M.getAttribute('id')),{id:z,href:A,label:O,subitems:[],parent:U}}},{key:'load',value:function(T){var z=this;return T.map(function(N){return N.label=N.title,N.children&&(N.subitems=z.load(N.children)),N})}},{key:'forEach',value:function(T){return this.toc.forEach(T)}}]),L}();k.default=P,v.exports=k['default']},function(v,k,_){'use strict';function C(L,R){if(!(L instanceof R))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function L(R,T){for(var z=0,N;z<T.length;z++)N=T[z],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(R,N.key,N)}return function(R,T,z){return T&&L(R.prototype,T),z&&L(R,z),R}}(),E=_(0),P=function(){function L(R){C(this,L),this.manifest={},this.navPath='',this.ncxPath='',this.coverPath='',this.spineNodeIndex=0,this.spine=[],this.metadata={},R&&this.parse(R)}return S(L,[{key:'parse',value:function(T){var z,N,A;if(!T)throw new Error('Package File Not Found');if(z=(0,E.qs)(T,'metadata'),!z)throw new Error('No Metadata Found');if(N=(0,E.qs)(T,'manifest'),!N)throw new Error('No Manifest Found');if(A=(0,E.qs)(T,'spine'),!A)throw new Error('No Spine Found');return this.manifest=this.parseManifest(N),this.navPath=this.findNavPath(N),this.ncxPath=this.findNcxPath(N,A),this.coverPath=this.findCoverPath(T),this.spineNodeIndex=(0,E.indexOfElementNode)(A),this.spine=this.parseSpine(A,this.manifest),this.metadata=this.parseMetadata(z),this.metadata.direction=A.getAttribute('page-progression-direction'),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}},{key:'parseMetadata',value:function(T){var z={title:this.getElementText(T,'title'),creator:this.getElementText(T,'creator'),description:this.getElementText(T,'description'),pubdate:this.getElementText(T,'date'),publisher:this.getElementText(T,'publisher'),identifier:this.getElementText(T,'identifier'),language:this.getElementText(T,'language'),rights:this.getElementText(T,'rights'),modified_date:this.getPropertyText(T,'dcterms:modified'),layout:this.getPropertyText(T,'rendition:layout'),orientation:this.getPropertyText(T,'rendition:orientation'),flow:this.getPropertyText(T,'rendition:flow'),viewport:this.getPropertyText(T,'rendition:viewport')};return z}},{key:'parseManifest',value:function(T){var z={},N=(0,E.qsa)(T,'item'),A=Array.prototype.slice.call(N);return A.forEach(function(B){var O=B.getAttribute('id'),I=B.getAttribute('href')||'',M=B.getAttribute('media-type')||'',U=B.getAttribute('properties')||'';z[O]={href:I,type:M,properties:U.length?U.split(' '):[]}}),z}},{key:'parseSpine',value:function(T){var N=[],A=T.getElementsByTagName('itemref'),B=Array.prototype.slice.call(A);return B.forEach(function(O,I){var M=O.getAttribute('idref'),U=O.getAttribute('properties')||'',W=U.length?U.split(' '):[],D={idref:M,linear:O.getAttribute('linear')||'yes',properties:W,index:I};N.push(D)}),N}},{key:'findNavPath',value:function(T){var z=(0,E.qsp)(T,'item',{properties:'nav'});return!!z&&z.getAttribute('href')}},{key:'findNcxPath',value:function(T,z){var N=(0,E.qsp)(T,'item',{"media-type":'application/x-dtbncx+xml'}),A;return N||(A=z.getAttribute('toc'),A&&(N=T.getElementById(A))),!!N&&N.getAttribute('href')}},{key:'findCoverPath',value:function(T){var z=(0,E.qs)(T,'package'),N=z.getAttribute('version');if('2.0'===N){var A=(0,E.qsp)(T,'meta',{name:'cover'});if(A){var B=A.getAttribute('content'),O=T.getElementById(B);return O?O.getAttribute('href'):''}return!1}var I=(0,E.qsp)(T,'item',{properties:'cover-image'});return I?I.getAttribute('href'):''}},{key:'getElementText',value:function(T,z){var N=T.getElementsByTagNameNS('http://purl.org/dc/elements/1.1/',z),A;return N&&0!==N.length?(A=N[0],A.childNodes.length?A.childNodes[0].nodeValue:''):''}},{key:'getPropertyText',value:function(T,z){var N=(0,E.qsp)(T,'meta',{property:z});return N&&N.childNodes.length?N.childNodes[0].nodeValue:''}},{key:'load',value:function(T){var z=this;return this.metadata=T.metadata,this.spine=T.spine.map(function(N,A){return N.index=A,N}),T.resources.forEach(function(N,A){z.manifest[A]=N,N.rel&&'cover'===N.rel[0]&&(z.coverPath=N.href)}),this.spineNodeIndex=0,this.toc=T.toc.map(function(N){return N.label=N.title,N}),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}},{key:'destroy',value:function(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}}]),L}();k.default=P,v.exports=k['default']},function(v,k,_){'use strict';function S(z,N){if(!(z instanceof N))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function z(N,A){for(var B=0,O;B<A.length;B++)O=A[B],O.enumerable=O.enumerable||!1,O.configurable=!0,'value'in O&&(O.writable=!0),Object.defineProperty(N,O.key,O)}return function(N,A,B){return A&&z(N.prototype,A),B&&z(N,B),N}}(),P=_(1),L=function(z){return z&&z.__esModule?z:{default:z}}(P),R=_(0),T=function(){function z(N){S(this,z),this.pages=[],this.locations=[],this.epubcfi=new L.default,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,this.lastPage,N&&(this.pageList=this.parse(N)),this.pageList&&this.pageList.length&&this.process(this.pageList)}return E(z,[{key:'parse',value:function(A){var B=(0,R.qs)(A,'html'),O=(0,R.qs)(A,'ncx');if(B)this.toc=this.parseNav(A);else if(O)return}},{key:'parseNav',value:function(A){var B=(0,R.querySelectorByType)(A,'nav','page-list'),O=B?(0,R.qsa)(B,'li'):[],I=O.length,U=[],M,W;if(!O||0===I)return U;for(M=0;M<I;++M)W=this.item(O[M]),U.push(W);return U}},{key:'item',value:function(A){var B=(0,R.qs)(A,'a'),O=B.getAttribute('href')||'',I=B.textContent||'',M=parseInt(I),U=O.indexOf('epubcfi'),W,D,F;return-1==U?{href:O,page:M}:(W=O.split('#'),D=W[0],F=!!(1<W.length)&&W[1],{cfi:F,href:O,packageUrl:D,page:M})}},{key:'process',value:function(A){A.forEach(function(B){this.pages.push(B.page),B.cfi&&this.locations.push(B.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}},{key:'addCFIs',value:function(){this.pageList.forEach(function(A){!A.cfi})}},{key:'pageFromCfi',value:function(A){var B=-1;if(0===this.locations.length)return-1;var O=(0,R.indexOfSorted)(A,this.locations,this.epubcfi.compare);return-1==O?(O=(0,R.locationOf)(A,this.locations,this.epubcfi.compare),B=0<=O-1?this.pages[O-1]:this.pages[0],void 0!==B||(B=-1)):B=this.pages[O],B}},{key:'cfiFromPage',value:function(A){var B=-1;'number'!=typeof A&&(A=parseInt(A));var O=this.pages.indexOf(A);return-1!=O&&(B=this.locations[O]),B}},{key:'pageFromPercentage',value:function(A){var B=Math.round(this.totalPages*A);return B}},{key:'percentageFromPage',value:function(A){var B=(A-this.firstPage)/this.totalPages;return Math.round(1e3*B)/1e3}},{key:'percentageFromCfi',value:function(A){var B=this.pageFromCfi(A),O=this.percentageFromPage(B);return O}},{key:'destroy',value:function(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}}]),z}();k.default=T,v.exports=k['default']},function(v,k,_){'use strict';function C(U){return U&&U.__esModule?U:{default:U}}function S(U,W){if(!(U instanceof W))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function U(W,D){for(var F=0,H;F<D.length;F++)H=D[F],H.enumerable=H.enumerable||!1,H.configurable=!0,'value'in H&&(H.writable=!0),Object.defineProperty(W,H.key,H)}return function(W,D,F){return D&&U(W.prototype,D),F&&U(W,F),W}}(),P=_(4),L=_(0),R=_(5),T=C(R),z=_(16),N=C(z),A=_(3),B=C(A),O=_(6),I=C(O),M=function(){function U(W,D){S(this,U),this.settings={replacements:D&&D.replacements||'base64',archive:D&&D.archive,resolver:D&&D.resolver,request:D&&D.request},this.manifest=W,this.resources=Object.keys(W).map(function(F){return W[F]}),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}return E(U,[{key:'split',value:function(){this.html=this.resources.filter(function(D){if('application/xhtml+xml'===D.type||'text/html'===D.type)return!0}),this.assets=this.resources.filter(function(D){if('application/xhtml+xml'!==D.type&&'text/html'!==D.type)return!0}),this.css=this.resources.filter(function(D){if('text/css'===D.type)return!0})}},{key:'splitUrls',value:function(){this.urls=this.assets.map(function(D){return D.href}.bind(this)),this.cssUrls=this.css.map(function(D){return D.href})}},{key:'createUrl',value:function(D){var F=new T.default(D),H=N.default.lookup(F.filename);return this.settings.archive?this.settings.archive.createUrl(D,{base64:'base64'===this.settings.replacements}):'base64'===this.settings.replacements?this.settings.request(D,'blob').then(function(V){return(0,L.blob2base64)(V)}).then(function(V){return(0,L.createBase64Url)(V,H)}):this.settings.request(D,'blob').then(function(V){return(0,L.createBlobUrl)(V,H)})}},{key:'replacements',value:function(){var D=this;if('none'===this.settings.replacements)return new Promise(function(F){F(this.urls)}.bind(this));var W=this.urls.map(function(F){var H=D.settings.resolver(F);return D.createUrl(H).catch(function(V){return console.error(V),null})});return Promise.all(W).then(function(F){return D.replacementUrls=F.filter(function(H){return'string'==typeof H}),F})}},{key:'replaceCss',value:function(D,F){var H=[];return D=D||this.settings.archive,F=F||this.settings.resolver,this.cssUrls.forEach(function(V){var X=this.createCssFile(V,D,F).then(function(Y){var J=this.urls.indexOf(V);-1<J&&(this.replacementUrls[J]=Y)}.bind(this));H.push(X)}.bind(this)),Promise.all(H)}},{key:'createCssFile',value:function(D){var F=this,H;if(I.default.isAbsolute(D))return new Promise(function(J){J()});var V=this.settings.resolver(D),X;X=this.settings.archive?this.settings.archive.getText(V):this.settings.request(V,'text');var Y=this.urls.map(function(J){var Z=F.settings.resolver(J),Q=new B.default(V).relative(Z);return Q});return X?X.then(function(J){return J=(0,P.substitute)(J,Y,F.replacementUrls),H='base64'===F.settings.replacements?(0,L.createBase64Url)(J,'text/css'):(0,L.createBlobUrl)(J,'text/css'),H},function(){return new Promise(function(Z){Z()})}):new Promise(function(J){J()})}},{key:'relativeTo',value:function(D,F){return F=F||this.settings.resolver,this.urls.map(function(H){var V=F(H),X=new B.default(D).relative(V);return X}.bind(this))}},{key:'get',value:function(D){var F=this.urls.indexOf(D);return-1===F?void 0:this.replacementUrls.length?new Promise(function(H){H(this.replacementUrls[F])}.bind(this)):this.createUrl(D)}},{key:'substitute',value:function(D,F){var H;return H=F?this.relativeTo(F):this.urls,(0,P.substitute)(D,H,this.replacementUrls)}},{key:'destroy',value:function(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}}]),U}();k.default=M,v.exports=k['default']},function(v,k,_){'use strict';function C(B){return B&&B.__esModule?B:{default:B}}function S(B,O){if(!(B instanceof O))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function B(O,I){for(var M=0,U;M<I.length;M++)U=I[M],U.enumerable=U.enumerable||!1,U.configurable=!0,'value'in U&&(U.writable=!0),Object.defineProperty(O,U.key,U)}return function(O,I,M){return I&&B(O.prototype,I),M&&B(O,M),O}}(),P=_(0),L=_(1),R=C(L),T=_(9),z=C(T),N=_(4),A=function(){function B(O,I){S(this,B),this.idref=O.idref,this.linear='yes'===O.linear,this.properties=O.properties,this.index=O.index,this.href=O.href,this.url=O.url,this.next=O.next,this.prev=O.prev,this.cfiBase=O.cfiBase,I?this.hooks=I:(this.hooks={},this.hooks.serialize=new z.default(this),this.hooks.content=new z.default(this)),this.document=void 0,this.contents=void 0,this.output=void 0}return E(B,[{key:'load',value:function(I){var M=I||this.request||_(11),U=new P.defer,W=U.promise;return this.contents?U.resolve(this.contents):M(this.url).then(function(D){return this.document=D,this.contents=D.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){U.resolve(this.contents)}.bind(this)).catch(function(D){U.reject(D)}),W}},{key:'base',value:function(){return(0,N.replaceBase)(this.document,this)}},{key:'render',value:function(I){var M=new P.defer,U=M.promise;return this.output,this.load(I).then(function(W){var D='undefined'!=typeof navigator&&navigator.userAgent||'',F=0<=D.indexOf('Trident'),H;H='undefined'==typeof XMLSerializer||F?_(17).XMLSerializer:XMLSerializer;var V=new H;return this.output=V.serializeToString(W),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){M.resolve(this.output)}.bind(this)).catch(function(W){M.reject(W)}),U}},{key:'find',value:function(I){var M=this,U=[],W=I.toLowerCase(),O=function(F){for(var H=F.textContent.toLowerCase(),V=M.document.createRange(),J=-1,Q=150,X,Y,Z;-1!=Y;)Y=H.indexOf(W,J+1),-1!=Y&&(V=M.document.createRange(),V.setStart(F,Y),V.setEnd(F,Y+W.length),X=M.cfiFromRange(V),F.textContent.length<Q?Z=F.textContent:(Z=F.textContent.substring(Y-Q/2,Y+Q/2),Z='...'+Z+'...'),U.push({cfi:X,excerpt:Z})),J=Y};return(0,P.sprint)(M.document,function(D){O(D)}),U}},{key:'reconcileLayoutSettings',value:function(I){var M={layout:I.layout,spread:I.spread,orientation:I.orientation};return this.properties.forEach(function(U){var W=U.replace('rendition:',''),D=W.indexOf('-'),F,H;-1!=D&&(F=W.slice(0,D),H=W.slice(D+1),M[F]=H)}),M}},{key:'cfiFromRange',value:function(I){return new R.default(I,this.cfiBase).toString()}},{key:'cfiFromElement',value:function(I){return new R.default(I,this.cfiBase).toString()}},{key:'unload',value:function(){this.document=void 0,this.contents=void 0,this.output=void 0}},{key:'destroy',value:function(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}}]),B}();k.default=A,v.exports=k['default']},function(v,k,_){'use strict';function C(O){return O&&O.__esModule?O:{default:O}}function S(O,I){if(!(O instanceof I))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function O(I,M){for(var U=0,W;U<M.length;U++)W=M[U],W.enumerable=W.enumerable||!1,W.configurable=!0,'value'in W&&(W.writable=!0),Object.defineProperty(I,W.key,W)}return function(I,M,U){return M&&O(I.prototype,M),U&&O(I,U),I}}(),P=_(1),L=C(P),R=_(9),T=C(R),z=_(37),N=C(z),A=_(4),B=function(){function O(){S(this,O),this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new T.default,this.hooks.content=new T.default,this.hooks.content.register(A.replaceBase),this.hooks.content.register(A.replaceCanonical),this.hooks.content.register(A.replaceMeta),this.epubcfi=new L.default,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}return E(O,[{key:'unpack',value:function(M,U){var W=this;this.items=M.spine,this.manifest=M.manifest,this.spineNodeIndex=M.spineNodeIndex,this.baseUrl=M.baseUrl||M.basePath||'',this.length=this.items.length,this.items.forEach(function(D,F){var H=W.manifest[D.idref],V;D.index=F,D.cfiBase=W.epubcfi.generateChapterComponent(W.spineNodeIndex,D.index,D.idref),D.href&&(D.url=U(D.href,!0)),H&&(D.href=H.href,D.url=U(D.href,!0),H.properties.length&&D.properties.push.apply(D.properties,H.properties)),'yes'===D.linear?(D.prev=function(){for(var X=D.index,Y;0<X;){if(Y=this.get(X-1),Y&&Y.linear)return Y;X-=1}}.bind(W),D.next=function(){for(var X=D.index,Y;X<this.spineItems.length-1;){if(Y=this.get(X+1),Y&&Y.linear)return Y;X+=1}}.bind(W)):(D.prev=function(){},D.next=function(){}),V=new N.default(D,W.hooks),W.append(V)}),this.loaded=!0}},{key:'get',value:function(M){var U=0;if('undefined'==typeof M)for(;U<this.spineItems.length;){var W=this.spineItems[U];if(W&&W.linear)break;U+=1}else if(this.epubcfi.isCfiString(M)){var D=new L.default(M);U=D.spinePos}else'number'==typeof M||!1===isNaN(M)?U=M:'string'==typeof M&&0===M.indexOf('#')?U=this.spineById[M.substring(1)]:'string'==typeof M&&(M=M.split('#')[0],U=this.spineByHref[M]);return this.spineItems[U]||null}},{key:'append',value:function(M){var U=this.spineItems.length;return M.index=U,this.spineItems.push(M),this.spineByHref[M.href]=U,this.spineById[M.idref]=U,U}},{key:'prepend',value:function(M){return this.spineByHref[M.href]=0,this.spineById[M.idref]=0,this.spineItems.forEach(function(U,W){U.index=W}),0}},{key:'remove',value:function(M){var U=this.spineItems.indexOf(M);if(-1<U)return delete this.spineByHref[M.href],delete this.spineById[M.idref],this.spineItems.splice(U,1)}},{key:'each',value:function(){return this.spineItems.forEach.apply(this.spineItems,arguments)}},{key:'first',value:function(){for(var M=0,U;M<this.spineItems.length-1;){if(U=this.get(M),U&&U.linear)return U;M+=1}}},{key:'last',value:function(){for(var M=this.spineItems.length-1,U;0<M;){if(U=this.get(M),U&&U.linear)return U;M-=1}}},{key:'destroy',value:function(){this.each(function(M){return M.destroy()}),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}}]),O}();k.default=B,v.exports=k['default']},function(v,k,_){'use strict';function S(z,N){if(!(z instanceof N))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(z){return typeof z}:function(z){return z&&'function'==typeof Symbol&&z.constructor===Symbol&&z!==Symbol.prototype?'symbol':typeof z},P=function(){function z(N,A){for(var B=0,O;B<A.length;B++)O=A[B],O.enumerable=O.enumerable||!1,O.configurable=!0,'value'in O&&(O.writable=!0),Object.defineProperty(N,O.key,O)}return function(N,A,B){return A&&z(N.prototype,A),B&&z(N,B),N}}(),L=_(5),R=function(z){return z&&z.__esModule?z:{default:z}}(L),T=function(){function z(N){S(this,z),this.rendition=N,this._themes={default:{rules:{},url:'',serialized:''}},this._overrides={},this._current='default',this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}return P(z,[{key:'register',value:function(){return 0===arguments.length?void 0:1===arguments.length&&'object'===E(arguments[0])?this.registerThemes(arguments[0]):1===arguments.length&&'string'==typeof arguments[0]?this.default(arguments[0]):2===arguments.length&&'string'==typeof arguments[1]?this.registerUrl(arguments[0],arguments[1]):2===arguments.length&&'object'===E(arguments[1])?this.registerRules(arguments[0],arguments[1]):void 0}},{key:'default',value:function(A){return A?'string'==typeof A?this.registerUrl('default',A):'object'===('undefined'==typeof A?'undefined':E(A))?this.registerRules('default',A):void 0:void 0}},{key:'registerThemes',value:function(A){for(var B in A)A.hasOwnProperty(B)&&('string'==typeof A[B]?this.registerUrl(B,A[B]):this.registerRules(B,A[B]))}},{key:'registerUrl',value:function(A,B){var O=new R.default(B);this._themes[A]={url:O.toString()},this._injected[A]&&this.update(A)}},{key:'registerRules',value:function(A,B){this._themes[A]={rules:B},this._injected[A]&&this.update(A)}},{key:'apply',value:function(A){var B=this._current,O;this._current=A,this.update(A),O=this.rendition.getContents(),O.forEach(function(I){I.removeClass(B),I.addClass(A)})}},{key:'update',value:function(A){var B=this,O=this.rendition.getContents();O.forEach(function(I){B.add(A,I)})}},{key:'inject',value:function(A){var B=[],O=this._themes,I;for(var M in O)O.hasOwnProperty(M)&&M===this._current&&(I=O[M],(I.rules||I.url&&-1===B.indexOf(I.url))&&this.add(M,A),this._injected.push(M));'default'!=this._current&&A.addClass(this._current)}},{key:'add',value:function(A,B){var O=this._themes[A];O&&(O.url?B.addStylesheet(O.url):O.serialized||O.rules&&(B.addStylesheetRules(O.rules),O.injected=!0))}},{key:'override',value:function(A,B){var O=this,I=this.rendition.getContents();this._overrides[A]=B,I.forEach(function(M){M.css(A,O._overrides[A])})}},{key:'overrides',value:function(A){var N=this._overrides;for(var B in N)N.hasOwnProperty(B)&&A.css(B,N[B])}},{key:'fontSize',value:function(A){this.override('font-size',A)}},{key:'font',value:function(A){this.override('font-family',A)}},{key:'destroy',value:function(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}}]),z}();k.default=T,v.exports=k['default']},function(v,k,_){'use strict';var C=_(42),S=_(49),E=_(45),P=_(52),L;L=v.exports=function(R,T){var z,N,A,B,O;return 2>arguments.length||'string'!=typeof R?(B=T,T=R,R=null):B=arguments[2],null==R?(z=A=!0,N=!1):(z=P.call(R,'c'),N=P.call(R,'e'),A=P.call(R,'w')),O={value:T,configurable:z,enumerable:N,writable:A},B?C(S(B),O):O},L.gs=function(R,T,z){var N,A,B,O;return'string'==typeof R?B=arguments[3]:(B=z,z=T,T=R,R=null),null==T?T=void 0:E(T)?null==z?z=void 0:!E(z)&&(B=z,z=void 0):(B=T,T=z=void 0),null==R?(N=!0,A=!1):(N=P.call(R,'c'),A=P.call(R,'e')),O={get:T,set:z,configurable:N,enumerable:A},B?C(S(B),O):O}},function(v){'use strict';v.exports=function(){}},function(v,k,_){'use strict';v.exports=_(43)()?Object.assign:_(44)},function(v){'use strict';v.exports=function(){var C=Object.assign,S;return!('function'!=typeof C)&&(S={foo:'raz'},C(S,{bar:'dwa'},{trzy:'trzy'}),'razdwatrzy'===S.foo+S.bar+S.trzy)}},function(v,k,_){'use strict';var C=_(46),S=_(51),E=Math.max;v.exports=function(P,L){var z=E(arguments.length,2),R,T,N;for(P=Object(S(P)),N=function(A){try{P[A]=L[A]}catch(B){R||(R=B)}},T=1;T<z;++T)L=arguments[T],C(L).forEach(N);if(R!==void 0)throw R;return P}},function(v){'use strict';v.exports=function(C){return'function'==typeof C}},function(v,k,_){'use strict';v.exports=_(47)()?Object.keys:_(48)},function(v){'use strict';v.exports=function(){try{return Object.keys('primitive'),!0}catch(C){return!1}}},function(v,k,_){'use strict';var C=_(12),S=Object.keys;v.exports=function(E){return S(C(E)?Object(E):E)}},function(v,k,_){'use strict';var C=_(12),S=Array.prototype.forEach,E=Object.create,P=function(L,R){for(var T in L)R[T]=L[T]};v.exports=function(){var R=E(null);return S.call(arguments,function(T){C(T)&&P(Object(T),R)}),R}},function(v){'use strict';v.exports=function(C){if('function'!=typeof C)throw new TypeError(C+' is not a function');return C}},function(v,k,_){'use strict';var C=_(12);v.exports=function(S){if(!C(S))throw new TypeError('Cannot use null or undefined');return S}},function(v,k,_){'use strict';v.exports=_(53)()?String.prototype.contains:_(54)},function(v){'use strict';var C='razdwatrzy';v.exports=function(){return!('function'!=typeof C.contains)&&!0===C.contains('dwa')&&!1===C.contains('foo')}},function(v){'use strict';var C=String.prototype.indexOf;v.exports=function(S){return-1<C.call(this,S,arguments[1])}},function(v){v.exports=function(_){return _.webpackPolyfill||(_.deprecate=function(){},_.paths=[],!_.children&&(_.children=[]),Object.defineProperty(_,'loaded',{enumerable:!0,get:function(){return _.l}}),Object.defineProperty(_,'id',{enumerable:!0,get:function(){return _.i}}),_.webpackPolyfill=1),_}},function(v){if('undefined'==typeof p){var _=new Error('Cannot find module "JSZip"');throw _.code='MODULE_NOT_FOUND',_}v.exports=p}])});